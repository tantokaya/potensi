define("global_nav/models/UserCard",[],function(){var e=Backbone.CacheModel||Backbone.Model,t=e.extend({initialize:function(){var e=trulia.LegacyEventWrapper($(document));this.listenTo(e,"loggedOut.auth loggedIn.auth loggedInPro.auth",this.handleLoginChange)},clearCache:function(){return typeof e.prototype.clearCache=="function"&&e.prototype.clearCache.apply(this,arguments),this},handleLoginChange:function(){this.clearCache(),this.fetch()},defaults:{whitelist_user:!0,logged_in:!1,profile:{images:{medium:"http://static.trulia-cdn.com/images/userpic/user_m_00_m.gif",tiny:"http://static.trulia-cdn.com/images/userpic/user_m_00_t.gif"},name:"",status:""}},cache:{TTL:300,key:"userCard"},url:site_root+"_ajax/GlobalNav/UserCardAjax/get_user_card/"});return new t}),define("tpl!global_nav/templates/userCardDropdown",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="globalUserCardMenu dropdownBox dropdownBoxRight dropdownArrowRight box boxBasic backgroundBasic zIndexNavigation" data-role="global_user_card_menu">\n  <ul class="dropdownList">\n    ',_.each(card_links,function(e,t){_.each(e,function(n,r){n.is_rental?__p+='\n          <li id="renterProfileLink" data-action="'+((__t=encodeURI(n.url))==null?"":__t)+'" data-role="global_user_card_link global_user_card_menu_item global_user_card_menu_item__user_'+((__t=n.tracking.toLowerCase())==null?"":__t)+'" data-track="Profile|'+((__t=n.tracking)==null?"":__t)+'">\n            <div id="progressMeter" data-progress="'+((__t=n.profile_progress)==null?"":__t)+'">\n              <ul>\n                <li id="c1_r"><p><span class="pie pieLeft"></span></p></li>\n                <li id="c1_l"><p><span class="pie pieRight"></span></p></li>\n              </ul>\n              <div id="centerCircle">\n                <span><img src="'+((__t=profile.images.medium)==null?"":__t)+'"></span>\n              </div>\n            </div>\n            <div class="dropdownLink globalUserCardMenuLink">'+((__t=n.label)==null?"":__t)+" (<strong>"+((__t=n.profile_progress)==null?"":__t)+"%</strong>)</div>\n          </li>\n        ":(__p+='\n          <li>\n            <span data-action="'+((__t=encodeURI(n.url))==null?"":__t)+'" class="dropdownLink globalUserCardMenuLink" data-role="global_user_card_link global_user_card_menu_item global_user_card_menu_item__user_'+((__t=n.tracking.toLowerCase())==null?"":__t)+'" data-track="Profile|'+((__t=n.tracking)==null?"":__t)+'">\n              '+((__t=n.label)==null?"":__t)+"\n              ",n.is_new&&(__p+='\n                <strong class="badgeSecondary">New</strong>\n              '),__p+="\n            </span>\n          </li>\n        "),r==e.length-1&&t!==card_links.length-1&&(__p+='\n          <li class="dropdownDivider"></li>\n        '),__p+="\n      "}),__p+="\n    "}),__p+="\n  </ul>\n</div>";return __p}}),define("global_nav/views/UserCardDropdownView",["tpl!global_nav/templates/userCardDropdown"],function(e){return Backbone.View.extend({userCardDropdownTemplate:e,events:{"click [data-role~=global_user_card_menu_item]":"handleMenuClick"},initialize:function(){trulia.mixin.withLinks.apply(this)},handleMenuClick:function(e){this.linkHasRole(e.currentTarget,"global_user_card_menu_item__user_logout")?(e.preventDefault(),trulia.auth.logout()):this.processAction(e.currentTarget,e)},renderProfileProgressBar:function(){var e=$("#progressMeter").data("progress");$("#progressMeter").length>0&&(e<51?($("#progressMeter ul #c1_l p").css({"-webkit-transform":"rotate(0deg)","-moz-transform":"rotate(0deg)","-ms-transform":"rotate(0deg)",transform:"rotate(0deg)"}),$("#progressMeter ul #c1_r p").css({"-webkit-transform":"rotate("+e/5*18+"deg)","-moz-transform":"rotate("+e/5*18+"deg)","-ms-transform":"rotate("+e/5*18+"deg)",transform:"rotate("+e/5*18+"deg)"})):($("#progressMeter ul #c1_l p").css({"-webkit-transform":"rotate("+(e-50)/5*18+"deg)","-moz-transform":"rotate("+(e-50)/5*18+"deg)","-ms-transform":"rotate("+(e-50)/5*18+"deg)",transform:"rotate("+(e-50)/5*18+"deg)"}),$("#progressMeter ul #c1_r p").css({"-webkit-transform":"rotate(180deg)","-moz-transform":"rotate(180deg)","-ms-transform":"rotate(180deg)",transform:"rotate(180deg)"})),e<35?$("#progressMeter .pie").addClass("pieRed"):e>=35&&e<65?$("#progressMeter .pie").addClass("pieOrange"):e>=65&&e<100&&$("#progressMeter .pie").addClass("pieYellow"))},render:function(){var e=this.model.toJSON();this.$el.html(this.userCardDropdownTemplate(e)),e.profile&&e.profile.status&&e.profile.status=="Renter"&&this.renderProfileProgressBar()}})}),define("tpl!global_nav/templates/consumerUserCard",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="globalUserCardBadge userCardDefault pan txtC dropdown" data-role="global_user_card_badge">\n  <table style="height: 41px;">\n    <tr>\n      <td class="txtM">\n        <a href="'+((__t=propertyPageLink)==null?"":__t)+'">\n          <img class="globalUserCardBadgePicture" src="'+((__t=profile.images.tiny)==null?"":__t)+'" alt="'+((__t=profile.name)==null?"":__t)+'" data-role="global_user_card_badge_picture">\n        </a>\n      </td>\n      <td class="globalUserCardContent mtn txtL pls">\n        <div class="typeTruncate globalUserCardBadgeName txtL man pan" data-role="global_user_card_badge_name">'+((__t=profile.name)==null?"":__t)+'</div>\n      </td>\n    </tr>\n  </table>\n  <div id="userCardDropDownPlaceholder"></div>\n</div>';return __p}}),define("tpl!global_nav/templates/loggedOutUserCard",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="globalUserCardLinks" data-role="global_user_card_links">\n  <button class="globalUserCardLink globalUserCardSigninLink txtC mrl mtm btn btnDefault pvn phs" data-role="global_user_card_link global_user_card_signin_link">\n    Sign In\n  </button>\n</div>';return __p}}),define("global_nav/views/UserCardView",["global_nav/views/UserCardDropdownView","tpl!global_nav/templates/consumerUserCard","tpl!global_nav/templates/loggedOutUserCard"],function(e,t,n){return Backbone.View.extend({consumerUserTemplate:t,loggedOutUserTemplate:n,events:function(){return this.listenTo(this.model,"change",this.render),{"click [data-role~=global_user_card_signin_link]":"handleSignIn"}},initialize:function(e){_.bindAll(this,"render")},handleSignIn:function(e){e.preventDefault(),trulia.AuthPopup.show()},render:function(){var t=this.model.toJSON();return t&&t.logged_in?(t.propertyPageLink=site_root+"account/properties/",t.whitelist_user===!0&&(t.propertyPageLink=site_root+"account/boards/"),this.$el.html(this.consumerUserTemplate(t)),this.userCardDropdown=new e({el:"#userCardDropDownPlaceholder",model:this.model}),this.userCardDropdown.render()):this.$el.html(this.loggedOutUserTemplate),this}})}),define("collab/utilities/ErrorHandlers",[],function(){return{showLoginPopUp:function(e,t,n){e.status==401&&(_trulia_logged_in&&trulia.auth.logout(),trulia.AuthPopup.show({loginCopy:"Re-authorization is needed. Please log back in."}))}}}),define("collab/views/ProgressView",[],function(){return Backbone.View.extend({$progressEl:null,deferObj:null,className:"txtC",setDeferred:function(e){var t=this;t.deferObj=e,e.progress(function(){t.setProgress.apply(t,arguments)})},resetProgress:function(){this.setProgress(0,1)},setProgress:function(e,t){this.$progressEl.attr("value",e),this.$progressEl.attr("max",t)},initialize:function(e){this.$progressEl=$('<i class="iconSpinner"></i>'),e&&e.defer&&this.setDeferred(e.defer)},render:function(){this.$el.html(this.$progressEl)}})}),define("tpl!global_nav/templates/loggedInPanelContent",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- TODO: Remove static content and replace with dynamic BB Views -->\n<li class="innerPanel mvn hideVisually">\n  <div id="activityFeedPlaceholder"></div>\n</li>\n<li class="innerPanel mvn" data-role="board_panel">\n  <ul id="boardFeedTabs" class="tabs bbs backgroundBasic mvn txtC lhs" data-body="#boardFeedContent">\n    <li class="mvn"><a href="#" class="linkLowlight"><div class="pvs">My Boards</div></a></li>\n    <li class="mvn"><a href="#" class="linkLowlight"><div class="pvs">Saved Homes</div></a></li>\n    <li class="mvn"><a href="#" class="linkLowlight"><div class="pvs">Saved Rentals</div></a></li>\n  </ul>\n  <ul class="phm pbl" id="boardFeedContent">\n    <li>\n      <div id="boardFeedPlaceholder"></div>\n    </li>\n    <li>\n      <div id="propertyFeedPlaceholder"></div>\n    </li>\n    <li>\n      <div id="rentalFeedPlaceholder"></div>\n    </li>\n  </ul>\n  <br />\n</li>\n<li class="innerPanel mvn hideVisually">\n  <div class="phm">\n    <div id="savedSearchesFeedPlaceholder"></div>\n  </div>\n</li>';return __p}}),define("tpl!global_nav/templates/loggedOutPanelContent",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<!-- TODO: The look and copy hasn\'t been finalized, this will very likely change. It\'s just a placeholder for now -->\n<li class="innerPanel mvn">\n  <div class="txtC pam">\n    <p class="h5 typeEmphasize">Notifications</p>\n    <p class="h5 typeWeightNormal txtC mvm">Stay informed with your activity</p>\n    <p class="txtC mvl phl">\n      <button data-role="cta_sign_in" class="btn btnPrimary btn-primary"><span class="phl">Sign in</span></button>\n    </p>\n  </div>\n</li>\n<li class="innerPanel mvn">\n  <div class="txtC pam">\n    <p class="h5 typeEmphasize">Saved Boards</p>\n    <p class="h5 typeWeightNormal txtC mvm">Keep track of your favorite homes from one easy location.</p>\n    <p class="txtC mvl phl">\n      <button data-role="cta_sign_in" class="btn btnPrimary btn-primary"><span class="phl">Sign in</span></button>\n    </p>\n  </div>\n</li>\n<li class="innerPanel mvn">\n  <div class="txtC pam">\n    <p class="h5 typeEmphasize">Saved Searches</p>\n    <p class="h5 typeWeightNormal txtC mvm">Get notified when homes in your search criteria hit the market.</p>\n    <p class="txtC mvl phl">\n      <button data-role="cta_sign_in" class="btn btnPrimary btn-primary"><span class="phl">Sign in</span></button>\n    </p>\n  </div>\n</li>';return __p}}),define("collab/EventAggregator",[],function(){return _.extend({},Backbone.Events)}),define("collab/utilities/PropertyId",[],function(){var e=function(e,t,n){if(typeof e=="object"){var r=e;r.toJSON&&(r=r.toJSON()),e=r.propertyId||r.property_id,t=r.state||r.state_code||r.stateCode,n=r.searchType||r.search_type||r.indexSource}return this.propertyId=parseInt(e)||0,this.state=t||"",this.searchType=n||"for sale",this.id=this.propertyId+"-"+this.state+"-"+this.searchType,this.freeze&&this.freeze(),e+"-"+t+"-"+n};return e.prototype.toString=function(e){return e||(e=this),e.id},e}),define("collab/models/Property",["collab/utilities/PropertyId"],function(e){function r(e){return"http://thumbs.trulia-cdn.com/pictures/thumbs_3/"+e.path}var t=Backbone.Model.prototype,n=Backbone.Model.extend({urlRoot:site_root+"_service/TruliaCollaboration/properties",defaults:{photos:[]},initialize:function(t,r){t&&t.property_id&&!this.compositePropertyId&&(!t.searchType&&t.status&&(t.searchType=n.prototype.statusToSearchType(t.status)),this.compositePropertyId=new e(t)),this.set("id",this.compositePropertyId)},parse:function(e,n){n&&n.propertyIds&&(this.compositePropertyId=_.find(n.propertyIds,function(t){return t.propertyId==e.requested_property_id}),this.compositePropertyId&&(e.id=this.compositePropertyId.id));if(e&&e.photos&&e.photos.length){var i=_.map(e.photos,r);e.firstPhoto=i.shift(),e.photos=i}return t.parse.apply(this,arguments)}});return n.prototype.statusToSearchType=function(e){var t;switch(e){default:case"For Sale":case"Active Contingent":case"Pending":case"Withdrawn":case"Foreclosure":t="for sale";break;case"Unknown":t="unknown";break;case"Assessor":case"Assess":t="assessor";break;case"Sold":t="sold";break;case"For Rent":t="for rent";break;case"Classified":t="classified"}return t},n}),define("collab/collections/propertyCollection",["collab/models/Property","collab/utilities/PropertyId"],function(e,t){var n=Backbone.Collection.prototype,r=Backbone.Collection.extend({model:e,propertyIds:[],urls:function(){var e=this,t=[];if(this.propertyIds&&this.propertyIds.length){var n=site_root+"_ajax/Account/Board/get_properties/",r=_.filter(this.propertyIds,function(t){return e.get(t)?!1:!0});if(r&&r.length){var i=_.groupBy(r,"searchType");return _.each(i,function(e,r){var i=_.groupBy(e,"state");_.each(i,function(e,i){var s=_.pluck(e,"propertyId"),o=s.join(",");t.push(n+"?propertyIds="+o+"&state="+i+"&search_type="+r)})}),t}}return null},buildId:function(e,n,r){return new t(e,n,r)},fetch:function(e){if(e&&e.ids&&e.ids.length){var t=_.chain(e.ids).map(this.buildId).filter(function(e){return e.propertyId>0&&e.state}).value();this.propertyIds=t}var r=this.urls();if(r&&r.length){var i=this,s=[];return _.each(r,function(e){var t=n.fetch.call(i,{propertyIds:i.propertyIds,reset:!1,remove:!1,url:e});s.push(t)}),$.when.apply($,s)}return $.Deferred().resolve()},parse:function(e,t){var n;return e&&e.data?n=e.data:n=e,n}});return new r}),define("collab/utilities/sourceAttribution",[],function(){var e={get:function(){return{source:"web",source_version:_release_version_tab}},getInvitationAcceptSource:function(){return{accept_source:"web",accept_source_version:_release_version_tab}}};return e}),define("collab/models/BoardProperty",["collab/collections/propertyCollection","collab/utilities/sourceAttribution"],function(e,t){var n=Backbone.Model.prototype;return Backbone.Model.extend({boardId:null,url:function(){return site_root+"_service/TruliaCollaboration/boards/"+this.boardId+"/properties/"+(this.id||"")},initialize:function(e,n){n&&n.boardId&&(this.boardId=n.boardId),this.set({metadata:$.extend(this.get("metadata"),t.get())})},parse:function(e,t){return e&&e.metadata&&(e.id=e.metadata.id),e.property={},n.parse.apply(this,arguments)},attachToBoard:function(e){this.board=e,e&&(this.boardId=e.id,e.on("change:id",function(e){this.boardId=e.id},this))}})}),define("collab/collections/BoardPropertyCollection",["collab/models/BoardProperty","collab/collections/propertyCollection","collab/models/Property"],function(e,t,n){var r=Backbone.Collection.prototype;return Backbone.Collection.extend({model:e,board:null,boardId:null,url:function(){return this.boardId?site_root+"_service/TruliaCollaboration/boards/"+this.boardId+"/properties":site_root+"_service/TruliaCollaboration/properties"},initialize:function(e,t){t&&t.board&&this.attachToBoard(t.board),t&&t.boardId&&(this.boardId=t.boardId)},fetch:function(e){var n=this,i=$.Deferred(),s=null,o=function(){return r.fetch.apply(n,arguments)},u=function(){var e=n.map(function(e){var n=null;return e&&(n=t.buildId(e.toJSON()),e.compositePropertyId=n),n});return t.fetch({ids:e})},a=function(){return n.each(function(e){e.attachToBoard(n.board);var r=t.get(e.compositePropertyId);r&&e.set({property:r.toJSON()})}),$.Deferred().resolve()};return i.fail(function(){s&&s.abort&&s.abort(),s&&s.reject&&s.reject()}),s=o().done(function(){i&&!i.isRejected()&&(s=u().done(function(){i&&!i.isRejected()&&(s=a().done(function(){i.resolveWith(n)}))}))}),i},parse:function(e,t){var n;return e&&e.data?n=e.data:n=e,n},attachToBoard:function(e){this.board=e,this.boardId=e.id,e.on("change:id",function(e){this.boardId=e.id},this)},addBoardProperty:function(t){var r=new e({property_id:t.id,state_code:t.stateCode,search_type:n.prototype.statusToSearchType(t.status)},{boardId:this.boardId});r.save(),this.unshift(r)},removeBoardProperty:function(e){var t=this.get(e.id)||this.findWhere({property_id:e.id});t&&(t.destroy(),this.remove(t))}})}),define("collab/models/User",["global_nav/models/UserCard","collab/utilities/sourceAttribution"],function(e,t){var n=Backbone.Model.prototype,r=e;return Backbone.Model.extend({urlRoot:site_root+"_service/TruliaCollaboration/boards",defaults:{name:null,email_address:null,picture:null,me:!1},initialize:function(n,r){if(n&&n.metadata){var i=n.id||n.metadata.id;this.set("id",i),this.set("me",e.id===i),this.set("name",n.name?n.name:n.email_address),this.set({metadata:$.extend(this.get("metadata"),t.get())})}},parse:function(t){return t.id=t.metadata.id,t.me=e.id===t.id,t.name=t.name?t.name:t.email_address,delete t.metadata,delete t.link,t}})}),define("collab/collections/UserCollection",["collab/models/User"],function(e){var t=Backbone.Collection.prototype;return Backbone.Collection.extend({model:e,board:null,boardId:null,url:function(){return site_root+"_service/TruliaCollaboration/boards/"+this.boardId+"/users"},initialize:function(e,t){t&&(t.board&&this.attachToBoard(t.board),t.boardId&&(this.boardId=t.boardId))},parse:function(e,n){var r;return e&&e.data?r=e.data:r=e,r&&r.length&&(r=_.filter(r,function(e){return e&&(e.name||e.email_address)})),t.parse.call(this,r,n)},attachToBoard:function(e){this.board=e,this.boardId=e.id,e.on("change:id",function(e){this.boardId=e.id},this)}})}),define("collab/models/Board",["collab/collections/BoardPropertyCollection","collab/collections/UserCollection","collab/utilities/sourceAttribution"],function(e,t,n){var r=Backbone.Model.prototype,i=Backbone.Model.extend({urlRoot:site_root+"_service/TruliaCollaboration/boards",deleteBoardPropertyId:null,defaults:function(){return this.initSubCollections(),{picture:null,title:"Homes"}},initialize:function(e,t){var n=t&&t.boardId||e&&(e.boardId||e.id);this.id=n,t&&t.propertyId&&(this.propertyId=t.propertyId),this.setData(e)},fetch:function(e){var t=this;if(!e||e.fetchProperties!==!0)return r.fetch.apply(this,arguments);var n=$.Deferred(),i=null,s=function(){return r.fetch.apply(t,arguments)},o=function(){return $.when(t.properties.fetch())};return n.fail(function(){i&&i.abort&&i.abort(),i&&i.reject&&i.reject()}),i=s().done(function(){n&&!n.isRejected()&&(i=o().done(function(){n.resolveWith(t)}))}),n},save:function(e,t){e&&this.set(e),t=t||{},t.put=!0;var n=new i;n.id=this.id,n.save=r.save;var s=n.save({picture:this.get("picture"),title:this.get("title")},t),o=this;return s.done(function(){o.set(n.toJSON())}),s},parse:function(e,t){return e&&e.metadata&&(e.id=e.metadata.id,e.propertyTotal=e.metadata.total||0,e.picture&&(e.picture=e.picture.replace("thumbs_4","thumbs_3")),this.setData(e)),r.parse.apply(this,arguments)},setData:function(e){if(e){this.initSubCollections();if(e.users&&e.users.data){var t=this.users;t.total=e.users.metadata.total,t&&t.set(e.users.data)}if(e.length){var r=this.properties;r&&r.set(e)}if(e.property&&e.property.href){var i=e.property.href.match(/\/properties\/([0-9A-Za-z\-]+)\/?$/);this.deleteBoardPropertyId=i[1]}}this.unset("metadata"),this.unset("link"),this.unset("data"),this.unset("property"),this.unset("properties"),this.unset("users"),this.set({metadata:$.extend(this.get("metadata"),n.get())})},initSubCollections:function(){this.users||(this.users=new t(null,{board:this})),this.properties||(this.properties=new e(null,{board:this}))},addProperty:function(e){var t=this.properties;t.addBoardProperty(e)},removeProperty:function(e){var t=this.properties;e.id||(e.id=e.get("property_id")),t.removeBoardProperty(e)}});return i}),define("collab/collections/boardCollection",["collab/models/Board"],function(e){var t=Backbone.CacheCollection||Backbone.Collection,n=t.extend({model:e,url:site_root+"_service/TruliaCollaboration/boards",cache:!1,initialize:function(){var e=this.clearCache||function(){};this.on("add remove",e,this);var t=trulia.LegacyEventWrapper($(document));this.listenTo(t,"loggedOut.auth",e),this.listenTo(t,"loggedIn.auth",e)},parse:function(e,t){var n;return e&&e.data?n=e.data:n=e,n}});return new n}),define("collab/utilities/boardPicture",[],function(){function n(n){return e[t(n)%e.length]}var e=[_IMAGE_SERVER_ROOT+"/images/collab/ie_home1.png",_IMAGE_SERVER_ROOT+"/images/collab/ie_home2.png",_IMAGE_SERVER_ROOT+"/images/collab/ie_home3.png",_IMAGE_SERVER_ROOT+"/images/collab/ie_home4.png",_IMAGE_SERVER_ROOT+"/images/collab/ie_home5.png"],t=_.memoize(function(t){return parseInt(t.replace(/[^A-Fa-f0-9]/g,""),16)});return{getBlurredPicture:function(e){var t=e.get("picture");return trulia.browser.isMSIE&&trulia.browser.version>8&&(t=n(e.get("id"))),t}}}),define("tpl!collab/templates/modalBoard",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="col box boxBasic homesBoardIcon clickable mrl backgroundInverseAlternate">\n  ',picture&&(__p+='\n    <div class="boardImg" style="background-image:url('+((__t=picture)==null?"":__t)+')">\n    </div>\n  '),__p+='\n  <div class="buttonFavorite is-favorited">\n    <i class="iconSaveHeart"></i>\n  </div>\n  <div class="boardBody">\n    <div class="boardTitle plm typeReversed typeContrast typeDeemphasize h5">\n      <span title="'+((__t=title)==null?"":_.escape(__t))+'" class="boardTitleText">\n        ',title.length>15?__p+="\n          "+((__t=title.substring(0,20))==null?"":_.escape(__t))+"…\n        ":__p+="\n          "+((__t=title)==null?"":_.escape(__t))+"\n        ",__p+='\n      </span>\n    </div>\n    <ul class="phm">\n      <li class="typeReversed mvn">\n        <div id="userPlaceholder" class="typeTruncate"></div>\n      </li>\n      <li class="typeLowlight mvn h7">\n        <div id="propertyCount">'+((__t=propertyTotal)==null?"":__t)+" home",propertyTotal!=1&&(__p+="s"),__p+="</div>\n      </li>\n    </ul>\n  </div>\n</div>";return __p}}),define("tpl!collab/templates/userListFull",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+="",picture&&name&&(__p+='\n<div class="line mln pvs">\n  <div class="col">\n    <img src="'+((__t=picture)==null?"":__t)+'" class="photoView boardUserImage imgCircle mrl mediaInline"/>\n  </div>\n  <div class="col pln pts typeTruncate">\n    '+((__t=name)==null?"":__t)+"\n  </div>\n</div>\n"),__p+="\n",name&&!picture&&(__p+='\n<div class="line mln mtm">\n  <div class="col cols3 ">\n    <div class="boardModalUserInitialCircle h5 mts typeReversed txtC typeDeemphasize">\n      <div class="txtC pts">'+((__t=name.charAt(0).toUpperCase())==null?"":__t)+"</div>\n    </div>\n  </div> \n  ",invitation_status==="pending"?__p+='\n    <div class="col ptm plm">\n      <div class="col cols16 mediaInline pls typeTruncate">'+((__t=name)==null?"":__t)+'</div>\n        <div class="typeLowlight">Pending</div>\n  ':__p+='\n    <div class="mls plm ptm">\n      <div class="mediaInline">'+((__t=name)==null?"":__t)+"</div>\n    </div>\n  ",__p+="\n</div> \n"),__p+="\n";return __p}}),define("collab/views/UserView",["tpl!collab/templates/userListFull"],function(e){function r(e){if(e.indexOf("@")>-1){var t=e.split("@");return t[0]}if(e.indexOf(" ")>-1){var t=e.split(" ");return t[0]}return e}var t="full",n="simple";return Backbone.View.extend({tagName:"span",className:"userList",renderType:"simple",renderTypes:{full:t,simple:n},initialize:function(e,n){n&&(n.renderType&&(this.renderType=n.renderType,this.renderType===t&&(this.tagName="ul")),typeof n.maxNumberToRender=="number"&&(this.maxNumberToRender=n.maxNumberToRender))},render:function(){if(this.model&&this.model.models){var e=this.model.models,r=this.model.total||e.length;this.renderType===t?this.renderFull(e):this.renderType===n&&this.renderSimple(e,r)}},renderSimple:function(e,t){if(t<=1)this.$el.text("Only Me");else if(t===2){var n=_.find(e,function(e){return!e.get("me")}),i=n&&n.get("name")?n.get("name"):"Someone";i=r(i),this.$el.text("Me and "+i)}else t<=5?this.$el.text("Me and "+(t-1)+" others"):this.$el.text("Me and +5 others")},renderFull:function(e){for(var t=0;t<e.length;t++){var n=this.template(e[t].toJSON());n=n.trim(),this.$el.append(n)}},template:e})}),define("collab/views/BoardSummaryModalView",["collab/utilities/boardPicture","tpl!collab/templates/modalBoard","collab/views/UserView"],function(e,t,n){return Backbone.View.extend({events:{"click .homesBoardIcon":"toggleSelect"},initialize:function(e,t){this.propertyId=t.propertyId,this.render()},toggleSelect:function(e){var t=this.$el.find(".homesBoardIcon");t.hasClass("iconCreateNewBoard")||(t.prop("selected",!t.prop("selected")),t.find(".buttonFavorite").toggleClass("is-favorited"))},render:function(t){var r=this.model.toJSON();_.extend(r,{picture:e.getBlurredPicture(this.model)});var i=this.template(r);this.$el.html(i);var s=this.model.users,o=new n({model:s},{renderType:"simple"});return o.render(),this.$("#userPlaceholder").html(o.el),this},template:t})}),define("collab/views/BoardSummaryListModalView",["collab/views/BoardSummaryModalView"],function(e){return Backbone.View.extend({el:"#boardSummaryListModalViewsPlaceHolder",initialize:function(e,t){this.propertyId=t.propertyId,this.selectedBoards=t.selectedBoards,this.render()},render:function(t){if(this.model&&this.model.models){var n=this.model.models.length,r=this;_.each(this.model.models,function(t){var i=new e({model:t},{propertyId:this.propertyId}),s=$(i.el).find(".homesBoardIcon"),o=$(i.el).find(".buttonFavorite");s.attr("id",t.id),this.$el.append(i.el),this.selectedBoards.findWhere({id:t.id})?(s.prop("selected",!0),o.addClass("is-favorited")):(s.prop("selected",!1),o.removeClass("is-favorited")),--n||($("#boardSummaryListModalLoadingStatus").hide(),r.$el.show())},this)}return this}})}),define("collab/models/UserInvitation",["collab/utilities/sourceAttribution"],function(e){var t=Backbone.Model.prototype;return Backbone.Model.extend({urlRoot:function(){if(this.boardId)return site_root+"_service/TruliaCollaboration/boards/"+this.boardId+"/invitations";throw"boardId is required"},defaults:{email:"",message:null},initialize:function(t,n){this.cleanUpEmail(),this.on("change:email",this.cleanUpEmail),this.set({metadata:$.extend(this.get("metadata"),e.get())});if(!n)throw"options.boardId is required";this.boardId=n.boardId,this.getInvitation=n.getInvitation},save:function(n,r){return r=r||{},r.put=!0,(this.get("invitation_status")==="accepted"||n&&n.invitation_status==="accepted")&&this.set({metadata:$.extend(this.get("metadata"),e.getInvitationAcceptSource())}),t.save.call(this,n,r)},fetch:function(e){var n={};return e.getInvitations&&(n={url:site_root+"_service/TruliaInvitation/boards/"+this.boardId+"/invitations/"+this.id}),t.fetch.call(this,n)},cleanUpEmail:function(){var e=this.get("email");e=e.trim(),this.set("email",e,{silent:!0})}})}),define("collab/utilities/updateCountdown",[],function(){var e=function(e){var t=e.val().length,n=e.closest("form"),r=n.find('[data-role="error_message"]'),i=n.find('[data-role="field_container"]'),s=n.find(".counter");if(t>=32)s.html("0"),s.removeClass("typeLowlight"),s.addClass("typeWarning");else{t=32-t,$.trim(e.val())===""&&(t=32);var o=t+"";s.html(o),t===32?(s.removeClass("typeLowlight"),s.addClass("typeWarning"),i.addClass("fieldWarning"),n.find(".btn").attr("disabled","true"),r.show()):(s.addClass("typeLowlight"),s.removeClass("typeWarning"),i.removeClass("fieldWarning"),n.find(".btn").removeAttr("disabled"),r.hide())}return};return e}),define("tpl!collab/templates/saveHomeToBoardModal",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="contentSaveHomeToBoard">\n  <div class="boxHead phl mbs">\n    <h3>Select Board</h3>\n  </div>\n  <div class="boxBody prn">\n    <div class="boxClose" data-role="popup_close">\n      <span role="presentation">×</span>\n      <span class="hideVisually">Close</span>\n    </div>\n    <div class="cols">\n      <div id="boardSummaryListModalLoadingStatus">\n        <p class="txtC"><i class="iconSpinner"></i></p>\n      </div>\n      <div id="boardSummaryListModalViewsPlaceHolder" class="hideVisually">\n        <div id="iconCreateNewBoard" class="col homesBoardIcon backgroundDarklight box boxBasic txtC typeReversed newBoardIcon clickable mrl">\n          <p class="mtl ptl mbn mll icon"><i class="iconPlus"></i></p>\n          <p class="mtn">Create Board</p>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="boxFoot">\n    <form class="form">\n      <div class="line">\n        <div class="col cols7">\n          <button id="btnSaveHomeToBoard" data-role="click_trackable submit" class="btn btnPrimary btnFullWidth btnSaveHomeToBoard" disabled="disabled">Done</button>\n        </div>\n        <div class="col lastCol pts">\n          <a href="#" class="typeLowlight cancelSave closeBoardFlowModal">Cancel</a>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>';return __p}}),define("collab/views/SaveHomeToBoardModalView",["collab/EventAggregator","tpl!collab/templates/saveHomeToBoardModal"],function(e,t){return Backbone.View.extend({template:t,events:{"click .homesBoardIcon":"selectBoard","click #iconCreateNewBoard":"createNewBoardView","click #btnSaveHomeToBoard":"saveHomeToBoardEvent"},initialize:function(e,t){this.render()},createNewBoardView:function(t){t.preventDefault(),e.trigger("collaboration:createNewBoard")},saveHomeToBoardEvent:function(t){t.preventDefault(),e.trigger("collaboration:saveHomeToBoardEvent")},selectBoard:function(e){this.$("#btnSaveHomeToBoard").prop("disabled",!1)},render:function(){return this.$el.html(this.template()),this}})}),define("tpl!collab/templates/createNewBoardContent",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="contentCreateNewBoard">\n  <div class="boxHead phl mbs">\n    <h3>Create Board</h3>\n  </div>\n  <div class="boxBody">\n    <div class="boxClose" data-role="popup_close">\n      <span role="presentation">×</span>\n      <span class="hideVisually">Close</span>\n    </div>\n    <form class="form">\n      <div data-role="field_container" class="mvm pts field">\n        <div class="cols19 line pbs pln">\n          <div class="col">\n            <label class="fieldLabel" for="boardname_field">Board Name</label>\n          </div>\n          <div class="col lastCol txtR typeLowlight counter">\n            32\n          </div>\n        </div>\n        <div class="fieldItem text cols12">\n          <input id="boardname_field" size="24" type="text" name="boardname" maxlength="32">\n          <div data-role="error_message" class="typeWarning hideVisually" style="display: none;">\n            Please name your board.\n          </div>\n        </div>\n      </div>\n      <div class="cols20 mln mtn typeLowlight pbl">\n        e.g. "Dream Homes" or "Home with Pools"\n      </div>\n      <div class="line ptl">\n        <div class="col cols7">\n          <button id="btnSaveBoard" data-role="click_trackable submit" class="btn btnPrimary btnFullWidth btnSaveBoard">Save</button>\n        </div>\n        <div class="col lastCol pts">\n          <a href="#" class="typeLowlight cancelSave closeBoardFlowModal">Cancel</a>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>';return __p}}),define("collab/views/CreateNewBoardView",["collab/EventAggregator","tpl!collab/templates/createNewBoardContent"],function(e,t){return Backbone.View.extend({template:t,events:{"click #btnSaveBoard":"createBoardEvent"},initialize:function(e,t){this.render()},createBoardEvent:function(t){t.preventDefault(),e.trigger("collaboration:createBoardEvent")},render:function(e){return this.$el.html(this.template()),o_track_ql_click("Collaboration|load create new board popup"),this}})}),define("tpl!collab/templates/shareYourBoardContent",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="contentShareYourBoard">\n  <div class="boxHead phl mbm">\n    <h3>Invite People to Board</h3>\n  </div>\n  <div class="boxBody">\n    <div class="boxClose" data-role="popup_close">\n      <span role="presentation">×</span>\n      <span class="hideVisually">Close</span>\n    </div>\n    <p class="cols19 intro mln">\n      These people will be able to add homes to the board.\n    </p>\n    <form class="form">\n      <div id="emailField" data-role="field_container" class="mvl pts field">\n        <div class="cols20 line pbs">\n          <div class="col">\n            <label class="fieldLabel" for="sharewith_field">Add Collaborators</label>\n          </div>\n        </div>\n        <div class="fieldItem text cols12">\n          <input id="sharewith_field" size="25" type="text" name="sharewith" placeholder="Use commas to separate email addresses">\n          <div data-role="error_message" class="typeWarning hideVisually" style="display: none;">\n            Please use a valid email address.\n          </div>\n        </div>\n      </div>\n      <div data-role="field_container" class="mbl field">\n        <div class="cols19 line pbs">\n          <div class="col">\n            <label class="fieldLabel" for="message_field">Message</label>\n          </div>\n        </div>\n        <span class="fieldItem text cols12">\n          <textarea id="message_field" cols="24" type="text" name="message" placeholder="Hey! This is going to make our home search sooooo much easier. Join me." maxlength="75"></textarea>\n          <span data-role="error_message" class="typeWarning hideVisually" style="display: none;"></span>\n        </span>\n      </div>\n      <div class="line">\n        <div class="col cols8">\n          <button id="btnShareBoard" data-role="click_trackable submit" class="btn btnPrimary btnFullWidth btnShareBoard">Share Board</button>\n        </div>\n        <div class="col lastCol pts">\n          <a href="#" class="typeLowlight skipThis closeBoardFlowModal">No Thanks</a>\n        </div>\n      </div>\n    </form>\n  </div>\n</div>\n';return __p}}),define("collab/views/ShareYourBoardView",["collab/EventAggregator","tpl!collab/templates/shareYourBoardContent"],function(e,t){return Backbone.View.extend({template:t,events:{"blur #sharewith_field":"emailFieldView","click #btnShareBoard":"shareBoardEvent"},shareBoardEvent:function(t){t.preventDefault(),e.trigger("collaboration:shareBoardEvent",{boardId:this.model.id})},emailFieldView:function(e){var t=this.$el.find("form"),n=t.find('[data-role="error_message"]'),r=t.find("#emailField");this.isEmailValid()?(n.hide(),r.removeClass("fieldWarning")):(n.show(),r.addClass("fieldWarning"))},isEmailValid:function(e){var t=this.getEmailValues();if(t.length===0)return!1;var n=t.length,r=!0,i=0;while(r&&i<n)is_valid_email(t[i])||(r=!1),i++;return r},getEmailValues:function(){return this.$el.find("#sharewith_field").val().split(",")},initialize:function(){this.render()},render:function(){return this.$el.html(this.template()),this}})}),define("tpl!collab/templates/modalFrame",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="oocss">\n  <div id="boardFlowModal" class="modal box boxBasic boxHighlight backgroundLowlight pal"></div>\n</div>';return __p}}),define("collab/collections/BoardsQuerier",["collab/models/Board"],function(e){var t=Backbone.Collection.prototype;return Backbone.Collection.extend({model:e,url:function(){return this.compositePropertyId?site_root+"_service/TruliaCollaboration/boards?pid="+this.compositePropertyId.propertyId+"&state="+this.compositePropertyId.state+"&search_type="+this.compositePropertyId.searchType.toLowerCase().replace(" ","+"):site_root+"_service/TruliaCollaboration/boards"},initialize:function(e,t){t&&t.compositePropertyId&&(this.compositePropertyId=t.compositePropertyId)},parse:function(e,n){var r;return e&&e.data?r=e.data:r=e,t.parse.call(this,r,n)},removePropertyFromAllBoards:function(e){this.each(function(t){var n=function(){return t.fetch({fetchProperties:!0})};n().done(function(){t.removeProperty(e)})})}})}),define("collab/utilities/BatchQuery",[],function(){var e=function(){function a(e){var t=_.result(e,"url");return t&&(t=t.replace(new RegExp(site_root+"_service/(TruliaCollaboration|TruliaInvitation)/"),"")),t}function f(){var n=e;return u&&(n=t),n}var e=site_root+"_service/TruliaCollaboration/batch",t=site_root+"_service/TruliaInvitation/batch",n=[],r=[],i=!1,s=[],o,u=!1;this.queueGet=function(e,t,r){var i,o=a(e);return o&&(i={method:"GET",path:o,query:r?$.param(r):""},n.push(i),s.push(t)),this},this.queuePost=function(e,t){var r,i=e.toJSON(),o=a(e);return delete i.id,o&&(r={method:"POST",headers:{"Content-Type":"application/json"},path:o,body:JSON.stringify(i)},n.push(r),s.push(t)),this},this.queueDelete=function(e,t){var r,i=a(e);return i&&(r={method:"DELETE",path:i},n.push(r),s.push(t)),this},this.done=function(e){return typeof e=="function"&&(o=e),i&&typeof o=="function"&&o(r),this},this.setNoAuth=function(e){return u=e,this},this.execute=function(){return $.ajax(f(),{data:JSON.stringify({requests:n}),type:"POST",contentType:"application/json",success:_.bind(function(e,t){e&&e.responses&&_.each(e.responses,function(e){var t=JSON.parse(e.body),n=s.shift();r.push(t),typeof n=="function"&&n(t,e.status)}),typeof o=="function"&&o(r),i=!0},this)}),this},this.init=function(){return n=[],r=[],s=[],o=null,i=!1,u=!1,this}};return e}),define("tpl!collab/templates/successMessageModal",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="successModal" class="txtC modal beingModal box boxBasic boxHighlight backgroundLowlight" style="top:200px;">\n  <div class="boxBody mvl mhl pan pvl">\n    <h3>'+((__t=message)==null?"":__t)+"</h3>\n  </div>\n</div>";return __p}}),define("collab/views/SuccessMessageModal",["tpl!collab/templates/successMessageModal"],function(e){var t={mode:"float",overlay:"neutral",closeable:!0,closeSelector:".boxClose",width:255};return Backbone.View.extend({message:"Success",initialize:function(e){var t=this;t.message=e.message,t.render(),setTimeout(function(){t.close()},2e3)},render:function(){var e=this.template({message:this.message});this.setElement(e),this.$el.appendTo("body"),this.$el.modal(t),this.$el.modal("open")},close:function(){this.$el.modal("close"),this.remove()},template:e})}),define("collab/views/EditBoardsModalView",["collab/EventAggregator","collab/collections/boardCollection","collab/models/Property","collab/views/BoardSummaryListModalView","collab/models/Board","collab/models/BoardProperty","collab/models/UserInvitation","collab/utilities/updateCountdown","collab/views/SaveHomeToBoardModalView","collab/views/CreateNewBoardView","collab/views/ShareYourBoardView","tpl!collab/templates/modalFrame","collab/utilities/PropertyId","collab/collections/BoardsQuerier","collab/utilities/BatchQuery","collab/views/SuccessMessageModal"],function(e,t,n,r,i,o,u,a,f,l,c,h,p,d,v,m){var g={mode:"inline",overlay:"dark",closeable:!0,width:510},y={CREATE_NEW_BOARD:"createNewBoard",SAVE_HOME_TO_BOARD:"saveHomeToBoard",SHARE_YOUR_BOARD:"shareYourBoard",SHARE_HOME_WITH_FRIENDS:"shareHomeWithFriends"},b={LOGGED_IN:"LoggedIn",EXISTING_USER:"ExistingUser",NEW_USER:"NewUser"},w="add",E="remove",S=null,x=!1;_trulia_logged_in?S=b.LOGGED_IN:$(document).bind("loggedInDestroy.authPopup",function(e,t){S=t==="register"?b.NEW_USER:b.EXISTING_USER});var T=Backbone.View.extend({el:"body",template:h,currentState:y.CREATE_NEW_BOARD,property:null,events:{"click .closeBoardFlowModal":"cancelModalEvent","click .boxClose":"cancelModalEvent"},setState:function(e){this.currentState=e},shareBoardEvent:function(e){this.sendInviteEvent(e.boardId),this.closeModalEvent()},sendInviteEvent:function(e){var t=this.$("#sharewith_field").val(),n=this.$("#message_field").val(),r=t.split(","),i=[],e=e;n.length>0&&o_track_ql_click("Collaboration|Share board|Modify message");if(r.length>0){var o=s.pageName+"|Collaboration Invite|"+r.length+" invited";o_track_ql_click("Collaboration|Share board|Tap Share Board button"),trulia.track({events:60,eVars:{60:o}})}for(var a=0;a<r.length;a++){var f=new u({email:r[a],message:n},{boardId:e}),l=f.save();i.push(l)}return $.when.apply($,i)},createBoardEvent:function(e){this.property?this.createNewBoardWithPropertyEvent():this.createNewBoardWithoutPropertyEvent()},closeModalEvent:function(e){this.$el.modal("close").trigger("collaboration:closeBoardFlowModal",{close:!1}),this.propertySavedToNewBoard&&(this.showSuccessModalPopup("Home Saved"),this.propertySavedToNewBoard=!1)},cancelModalEvent:function(e){this.$el.modal("close").trigger("collaboration:closeBoardFlowModal",{close:!0}),this.propertySavedToNewBoard&&(this.showSuccessModalPopup("Home Saved"),this.propertySavedToNewBoard=!1)},createNewBoardView:function(e){this.$el.modal(g),this.$el.modal("open"),e&&e.emptyBoard&&(this.property=null);var t=new l;this.$el.html(t.$el);var n="Homes";this.property&&this.property.city?n=this.property.city+" Homes":_.isEmpty(trulia.propertyData.get())||(n=trulia.propertyData.get().city+" Homes"),$("#boardname_field").val(n),a($("#boardname_field")),$("#boardname_field").on("keyup",function(e){a($(this))})},createNewBoardWithPropertyEvent:function(){var e=new trulia.followHome.FollowHome(this.property),n=new i({title:$.trim($("#boardname_field").val())},{propertyId:this.property.id});this.$el.html('<p class="txtC"><i class="iconSpinner"></i></p>');var r=this,o=$.Deferred(),u=function(){return n.save()},a=function(){return n.fetch({fetchProperties:!0})},f=function(){n.addProperty(r.property),e.follow(null,{collaborationMasterlist:!0}),t.unshift(n);var i=new c({model:n});r.$el.html(i.$el),r.propertySavedToNewBoard=!0,o_track_ql_click("Collaboration|Share board|Popup Load")};u().done(function(){o&&!o.isRejected()&&a().done(function(){o&&!o.isRejected()&&f()})}),trulia.track({name:"EventBoardsModalView.createNewBoardWithPropertyEvent",props:{33:s.pageName+"|Collaboration|Save|Create board add property"},eVars:{4:s.pageName+"|Collaboration|Create board|"+S,63:s.pageName+"|Collaboration|Save button|Board saved"},events:[8,55]})},createNewBoardWithoutPropertyEvent:function(){var e=this,n=new i({title:$.trim($("#boardname_field").val())}),r=function(){var t=new c({model:n});e.$el.html(t.$el),o_track_ql_click("Collaboration|Share board|Popup Load")};n.save().done(function(){t.unshift(n),r()}),trulia.track({name:"EventBoardsModalView.createNewBoardWithoutPropertyEvent",props:{33:s.pageName+"|Collaboration|Save|Create board"},eVars:{63:s.pageName+"|Collaboration|Save button|Board saved"},events:[55]})},saveHomeToBoardView:function(e){var n=this;this.property=e.property,t.fetch().done(function(){n.$el.is(":visible")||(n.setState(y.SAVE_HOME_TO_BOARD),n.$el.modal(g),n.$el.modal("open"));if(t.length){var e=new f;n.$el.html(e.$el),n.existingBoardsDetailsView(t),o_track_ql_click("Collaboration|Save to board")}else n.createNewBoardView()}).fail(this.handleFailure),o_track_ql_click("Collaboration|Tap property save button")},existingBoardsDetailsView:function(e){var t=this;if(this.property){var i=new n(this.property),s=new d(null,{compositePropertyId:i.compositePropertyId});s.fetch().done(function(){var t=new r({model:e},{propertyId:i.id,selectedBoards:s})})}},saveHomeToBoardEvent:function(e){if(this.property){var r=this,i=new trulia.followHome.FollowHome(r.property),s=new n(this.property),u=new v,a=new d(null,{compositePropertyId:s.compositePropertyId}),f={};this.$(".homesBoardIcon:not(#iconCreateNewBoard)").each(function(){$(this).prop("selected")?f[$(this).attr("id")]=w:f[$(this).attr("id")]=E}),a.fetch().done(function(){var e,s=!1,l={},c=a.length,h=!1,p=!1;a.each(function(e){f[e.id]===w?delete f[e.id]:f[e.id]===E&&e.deleteBoardPropertyId&&(l[e.id]=e.deleteBoardPropertyId)}),_.each(f,function(t,s){t===w&&(e=new o({property_id:r.property.id,state_code:r.property.stateCode,search_type:n.prototype.statusToSearchType(r.property.status)},{boardId:s}),u.queuePost(e,function(){i.follow(null,{collaborationMasterlist:!0,trackSaveHomeToBoard:!0,sourceAction:"Collaboration|Add home to board|Save"}),c++,h=!0}))}),_.each(l,function(i,s){e=new o({property_id:r.property.id,state_code:r.property.stateCode,search_type:n.prototype.statusToSearchType(r.property.status)},{boardId:s}),e.id=i,u.queueDelete(e,function(){var n=t.get(s);if(n&&n.properties){var r=n.properties.get(e.id);r&&r.destroy()}c--,p=!0})}),u.execute().done(function(){c<1&&i.unfollow({forceUnFollow:!0}),r.closeModalEvent(),h?r.showSuccessModalPopup("Home Saved"):p&&r.showSuccessModalPopup("Home Removed")})})}},showSuccessModalPopup:function(e){var t=new m({message:e})},removePropertyFromAllBoards:function(e){this.property=e.propertyData,this.property.property_id=this.property.id;var t=new p(this.property);this.property.compositePropertyId=t;var n=new d(null,{compositePropertyId:t});n.fetch().done(function(){n.removePropertyFromAllBoards(this.property)})},handleFailure:function(){var e="Log in to track your favorite homes.",t={id:"collabInvalidBoard",globalHeader:"Save this home to get updates",loginCopy:e,registerStep1Copy:e,forceShowLogin:!0};_trulia_logged_in=0,trulia.AuthPopup.show(t)},initialize:function(t){_.bindAll(this,"render"),this.render(),this.listenTo(e,"collaboration:savehometoboard",this.saveHomeToBoardView),this.listenTo(e,"collaboration:createNewBoard",this.createNewBoardView),this.listenTo(e,"collaboration:createBoardEvent",this.createBoardEvent),this.listenTo(e,"collaboration:saveHomeToBoardEvent",this.saveHomeToBoardEvent),this.listenTo(e,"collaboration:shareBoardEvent",this.shareBoardEvent),this.listenTo(e,"collaboration:deletePropertyFromAllBoards",this.removePropertyFromAllBoards)},render:function(){return this.$el.append(this.template()),this.setElement("#boardFlowModal"),this}});return new T}),define("collab/views/NewBoardLinkView",["collab/views/EditBoardsModalView","collab/EventAggregator"],function(e,t){return Backbone.View.extend({tagName:"div",className:"prl txtR",options:{emptyBoard:!1},events:{"click #btnNewBoard":"createNewBoard"},createNewBoard:function(e){e.preventDefault(),t.trigger("collaboration:createNewBoard",{emptyBoard:this.options.emptyBoard})},initialize:function(e){$.extend(this.options,e),this.render()},render:function(){return this.$el.empty(),this.$el.append('<a href="" id="btnNewBoard" class="iconPlus"> Create Board</a>'),this}})}),define("tpl!collab/templates/contentBoard",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="contentBoard boardSummary backgroundInverseAlternate">\n  <div class="contentOverlay"></div>\n  <div class="boardImage" ',picture&&(__p+=' style="background-image: url('+((__t=picture)==null?"":__t)+')"'),__p+='></div>\n  <section class="contentBoardBody cols22">\n    <div class="h2 typeReversed typeDeemphasize">'+((__t=title)==null?"":_.escape(__t))+'</div>\n  </section>\n  <section class="boardSummaryFooter">\n    <div id="userPlaceholder" class="typeReversed h5 typeWeightNormal mbn"></div>\n    <span class="typeLowlight h1 h7 typeWeightNormal">'+((__t=propertyTotal)==null?"":__t)+" home",propertyTotal!==1&&(__p+="s"),__p+="</span>\n  </section>\n</div>";return __p}}),define("collab/views/BoardSummary",["collab/views/UserView","collab/utilities/boardPicture","tpl!collab/templates/contentBoard"],function(e,t,n){return Backbone.View.extend({tagName:"li",className:"clickable",events:{click:"goToBoard"},goToBoard:function(){var e="boards/"+this.model.id;Backbone.history.options&&Backbone.history.options.isBoardPage?Backbone.history.navigate(e,!0):window.location.href=site_root+"account/"+e},render:function(n){var r=this.model.toJSON(),i,s,o;return _.extend(r,{picture:t.getBlurredPicture(this.model)}),i=this.template(r),this.$el.html(i),s=this.model.users,o=new e({model:s},{renderType:"simple"}),o.render(),this.$("#userPlaceholder").html(o.el),this},template:n})}),define("tpl!collab/templates/emptyBoardList",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="txtC">\n  <h5 class="mvl">Get on Board</h5>\n  <div class="typeLowlight mhm">\n    Boards help you stay on top of your home search with\n    ',collapsed||(__p+="<br>"),__p+="\n    one place to organize, share and track homes.\n  </div>\n  ",collapsed||(__p+='\n    <div class="pvl">\n      <img alt="You currently have no boards" src="'+((__t=_IMAGE_SERVER_ROOT)==null?"":__t)+'/images/mobile/beaker/user/no_board.png" width="300">\n    </div>\n  '),__p+="\n</div>";return __p}}),define("collab/views/BoardEmptyList",["tpl!collab/templates/emptyBoardList"],function(e){return Backbone.View.extend({options:{collapsed:!1},tagName:"div",className:"ptm",initialize:function(e){$.extend(this.options,e)},render:function(e){this.$el.html(this.template(this.options))},template:e})}),define("collab/views/BoardSummaryList",["collab/views/BoardSummary","collab/views/BoardEmptyList"],function(e,t){var n=!1;return Backbone.View.extend({tagName:"ul",initialize:function(e,t){this.model&&this.model.on("all",this.render,this),e&&(n=e.collapsed)},render:function(r){this.$el.empty();if(this.model&&this.model.models&&this.model.length){var i=this.model.models,s=[];for(var o=0;o<i.length;o++){var u=i[o],a=new e({model:u});a.render(),s.push(a.el)}this.$el.append(s)}else{var f=new t({collapsed:n});f.render(),this.$el.html(f.el)}return this}})}),define("tpl!collab/templates/smallPropertySummary",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="contentCard media backgroundBasic mvn jsNavigateToProperty">\n  <div class="mediaImg mrm">\n    <div class="smallPanelImageContainer">\n      ',property.firstPhoto&&(__p+='\n      <img src="'+((__t=property.firstPhoto)==null?"":__t)+'">\n      '),__p+='\n    </div>\n  </div>\n  <div class="mediaBody line pts h7">\n    <a href="'+((__t=property.pdpURL)==null?"":__t)+'" class="activeLink">\n      <ul class="mvn mls lvn" style="width:165px">\n        ',property.prevPriceDolChge?__p+='\n        <li class="typeEmphasize mvn '+((__t=property.prevPriceDolChge>0?"typeHighlight":"typeWarning")==null?"":__t)+'">\n          <span class="h5">'+((__t=property.price)==null?"":__t)+' <i class="'+((__t=property.prevPriceDolChge>0?"iconDown":"iconUp")==null?"":__t)+'"></i></span>\n        </li>\n        ':(__p+='\n        <li class="typeEmphasize mvn">\n          <span class="h5">',property.price&&(__p+=""+((__t=property.price)==null?"":__t)+""),__p+="</span>\n        </li>\n        "),__p+='\n        <li class="mtn">\n          ',property.bedrooms&&(__p+=""+((__t=property.bedrooms)==null?"":__t)+" bd"),__p+="\n          ",property.bathrooms&&(__p+="&nbsp;&nbsp;"+((__t=property.bathrooms)==null?"":__t)+" ba"),__p+="\n          ",property.squareFeet&&(__p+="&nbsp;&nbsp;"+((__t=property.squareFeet)==null?"":__t)+" sqft "),__p+='\n        </li>\n        <li class="typeDeemphasize typeTruncate typeLowlight mbn">'+((__t=property.streetAddress)==null?"":__t)+'</li>\n        <li class="typeDeemphasize typeTruncate typeLowlight mtn">\n          '+((__t=property.city)==null?"":__t)+", "+((__t=property.state)==null?"":__t)+" "+((__t=property.zipCode)==null?"":__t)+"\n        </li>\n      </ul>\n    </a>\n  </div>\n</div>";return __p}}),define("collab/views/SmallPropertySummary",["tpl!collab/templates/smallPropertySummary"],function(e){return Backbone.View.extend({tagName:"li",initialize:function(e){this.options.summaryTemplate&&(this.template=this.options.summaryTemplate)},render:function(e){var t=this.template(this.model.toJSON());return this.$el.html(t),this},template:e})}),define("tpl!collab/templates/emptyBoard",[],function(){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="txtC">\n  <h5 class="mvl typeWeightNormal">\n    You haven’t added any homes yet.<br>\n    Start searching for properties to add now.\n  </h5>\n  <a class="btn btnPrimary" href="'+((__t=site_root)==null?"":__t)+'">Search Homes</a>\n</div>';return __p}}),define("collab/views/PropertySummaryEmpty",["tpl!collab/templates/emptyBoard"],function(e){return Backbone.View.extend({tagName:"div",render:function(e){this.$el.html(this.template())},template:e})}),define("collab/views/PropertySummaryList",["collab/views/PropertySummaryEmpty"],function(e){return Backbone.View.extend({tagName:"ul",propertySummaryView:null,showHeart:!1,initialize:function(e,t){this.model&&this.model.on("all",this.render,this);if(!this.options.propertySummaryView)throw"propertySummaryView is required";this.propertySummaryView=this.options.propertySummaryView,this.options.showHeart&&(this.showHeart=this.options.showHeart)},render:function(t){if(this.model&&this.model.models&&this.model.length)this.$el.empty(),_.each(this.model.models,function(e){var t=new this.propertySummaryView({model:e,showHeart:this.showHeart});t.render(),this.$el.append(t.el)},this);else{var n=new e;n.render(),this.$el.html(n.el)}return this}})}),define("collab/collections/AllBoardPropertiesCollection",["collab/collections/BoardPropertyCollection"],function(e){var t=e.extend({url:site_root+"_service/TruliaCollaboration/properties"});return t}),define("collab/collections/AllRentalPropertiesCollection",["collab/collections/BoardPropertyCollection"],function(e){var t=e.extend({url:site_root+"_ajax/Account/Board/get_rentals/"});return t}),define("global_nav/views/SlidePanelView",["collab/utilities/ErrorHandlers","collab/views/ProgressView","tpl!global_nav/templates/loggedInPanelContent","tpl!global_nav/templates/loggedOutPanelContent","collab/views/NewBoardLinkView","collab/views/BoardSummaryList","collab/collections/boardCollection","collab/views/SmallPropertySummary","collab/views/PropertySummaryList","collab/collections/AllBoardPropertiesCollection","collab/collections/AllRentalPropertiesCollection"],function(e,t,n,r,i,s,o,u,a,f,l){return Backbone.View.extend({$boardFeedEl:"#boardFeedContent",panelOpen:!1,progressView:null,loginCfg:{},loggedOutPanelContentsTemplate:r,loggedInPanelContentsTemplate:n,events:function(){return this.listenTo(trulia.LegacyEventWrapper($(document)),"loggedOut.auth",this.closePanel),this.listenTo(trulia.LegacyEventWrapper($(document)),"loggedIn.auth",this.renderOnLogin),this.listenTo(trulia.LegacyEventWrapper($(window)),"mousewheel",this.controlScroll),{"click [data-role=cta_sign_in]":"triggerLoginPopup","scrolly:atSetPoint":"closePanelOnScroll"}},initialize:function(e){this.$el.scrolly({offset:trulia.GlobalNavSticky.get_top_nav_height()||21}),this.progressView=new t({className:"txtC ptl"}),this.progressView.render()},changePanelContent:function(){this.isPanelOpen()||(this.openPanel(),this.render())},isPanelOpen:function(){return this.panelOpen},controlScroll:function(e){if(this.isPanelOpen()&&this.$el.has(e.target).length>0){var t=this.$el.scrollTop()+this.$el.height(),n=this.$el.prop("scrollHeight"),r=e.originalEvent&&e.originalEvent.deltaY;t+r>=n&&(t<n&&this.$el.scrollTop(n),e.preventDefault&&e.preventDefault(),e.returnValue=!1)}},openPanel:function(){this.$el.css("right",0),this.panelOpen=!0,this.trigger("SlidePanel:open")},closePanel:function(){this.isPanelOpen()&&(this.$el.css("right",""),this.panelOpen=!1,this.trigger("SlidePanel:close"))},closePanelOnScroll:function(e,t){t&&this.closePanel()},triggerLoginPopup:function(e){e.preventDefault(),trulia.AuthPopup.show(this.loginCfg)},renderOnLogin:function(){this.isPanelOpen()&&this.render()},render:function(){_trulia_logged_in?(this.$("#panelContents").html(this.loggedInPanelContentsTemplate()),this.progressView.$el.show(),this.$(this.$boardFeedEl).before(this.progressView.el),this.renderBoardPanel(),this.$("#boardFeedTabs").truliaTabs()):this.$("#panelContents").html(this.loggedOutPanelContentsTemplate),this.trigger("SlidePanel:render")},renderBoardPanel:function(){var t=this,n=this.$("#boardFeedPlaceholder"),r=this.$("#propertyFeedPlaceholder"),c=this.$("#rentalFeedPlaceholder");t.defer=o.fetch().done(function(){var e=new i({className:"txtR prm pts",emptyBoard:!0}),h=new s({model:o,className:"lvs",collapsed:!0});t.progressView.$el.hide(),h.render(),n.empty(),n.append(e.el),n.append(h.el);var p=new f;t.defer=p.fetch({}).done(function(){var e=new a({model:p,propertySummaryView:u,className:"mvm lvs"});e.render(),r.empty(),r.append(e.el)});var d=new l;t.defer=d.fetch({noPropertyFetch:!0}).done(function(){var e=new a({model:d,propertySummaryView:u,className:"mvm lvs"});e.render(),c.empty(),c.append(e.el)})}).fail(e.showLoginPopUp)}})}),define("global_nav/views/FTUXTooltipView",[],function(){function r(r){window.localStorage?window.localStorage.setItem(e,t):setCookieTtl(e,t,n)}function i(){var n=!1;return window.localStorage?n=window.localStorage.getItem(e):n=getCookie(e),n===t}var e="clbftuxsrp",t="1",n=31556926;return Backbone.View.extend({initialize:function(){i()||(this.$el.tooltip({content:'<button id="srpFtuxTip" class="boxClose"><span role="presentation">&times;</span><span class="hideVisually">Close</span></button><div class="mrl">A new place to organize<br>your saved homes.</div>',anchor:"bottomright",skin:"tooltipDark",trigger:""}).tooltip("show"),$(".tooltip .boxClose").click(_.bind(function(){this.dismissCollabFTUXTooltip()},this)))},events:function(){return this.once("tip:close",this.dismissCollabFTUXTooltip),{}},dismissCollabFTUXTooltip:function(){this.$el.tooltip("remove"),r(!0)}})}),define("global_nav/views/SlidePanelTabsView",["global_nav/views/SlidePanelView","global_nav/views/FTUXTooltipView"],function(e,t){return Backbone.View.extend({currentTabIndex:0,cssClasses:{HIDE_VISUALLY:"hideVisually",SLIDE_PANEL_TABS_ACTIVE:"slidePanelTabsActive",SLIDE_PANEL_CARD_ACTIVE:"slidePanelCardActive"},events:function(){return this.listenTo(this.panelView,"SlidePanel:open",this.showClosingTab),this.listenTo(this.panelView,"SlidePanel:open",this.dismissCollabTooltip),this.listenTo(this.panelView,"SlidePanel:close",this.hideClosingTab),this.listenTo(this.panelView,"SlidePanel:render",this.refreshTabs),{"nav:change":"changeTab"}},initialize:function(n){this.closingTab=n.closingTab,this.userCardContainer=n.userCardContainer,this.bodyEl=n.bodyEl,this.$el.truliaTabs({selected:!1}),this.panelView=new e({el:"#slidePanel",bodyEl:this.bodyEl}),trulia.page_name&&trulia.page_name==="srp"&&(this.boardsTooltip=new t({el:'li[data-tab="boards"]'})),this.closingTab.on("click",_.bind(function(){this.panelView.closePanel()},this))},changeTab:function(e,t,n){this.currentTabIndex=n,t.data("tab")=="searches"?this.$el.on("tab:hide",_.bind(function(){this.panelView.$el.find("[data-role=board_panel]").show()},this)):this.panelView.changePanelContent()},showClosingTab:function(){this.closingTab.removeClass(this.cssClasses.HIDE_VISUALLY),this.$el.addClass(this.cssClasses.SLIDE_PANEL_TABS_ACTIVE),this.userCardContainer.addClass(this.cssClasses.SLIDE_PANEL_CARD_ACTIVE)},dismissCollabTooltip:function(){this.boardsTooltip&&this.boardsTooltip.trigger("tip:close")},hideClosingTab:function(){this.closingTab.addClass(this.cssClasses.HIDE_VISUALLY),this.$el.removeClass(this.cssClasses.SLIDE_PANEL_TABS_ACTIVE),this.userCardContainer.removeClass(this.cssClasses.SLIDE_PANEL_CARD_ACTIVE),this.$el.truliaTabs("select",!1)},refreshTabs:function(){this.$el.truliaTabs({selected:this.currentTabIndex})}})}),define("global_nav/views/TabSwitchView",["global_nav/views/SlidePanelTabsView"],function(e){return Backbone.View.extend({$starMenu:null,$slideMenu:null,slidePanelTabsView:null,events:function(){return this.listenTo(this.model,"sync",this.toggleMenu),{}},initialize:function(e){this.$starMenu=this.$("[data-role=star_menu_container]"),this.$slideMenu=this.$("[data-role=slide_panel_container]"),this.toggleMenu()},toggleMenu:function(){_trulia_logged_in&&this.model.get("whitelist_user")?(this.toggleMenuTabs(!0),this.slidePanelTabsView?this.slidePanelTabsView.delegateEvents():this.slidePanelTabsView=new e({el:"#slidePanelTabs",closingTab:$("[data-role=close_right_panel]"),userCardContainer:$("[data-role=global_user_card_container]")})):(this.toggleMenuTabs(!1),this.slidePanelTabsView&&this.slidePanelTabsView.undelegateEvents())},toggleMenuTabs:function(e){e===!0?(this.$starMenu.addClass("hideFully"),this.$slideMenu.removeClass("hideFully")):(this.$slideMenu.addClass("hideFully"),this.$starMenu.removeClass("hideFully"))}})}),define("global_nav/global_nav_main",["global_nav/models/UserCard","global_nav/views/UserCardView","global_nav/views/TabSwitchView"],function(e,t,n){e.clearCache().fetch().then(function(){var r=new t({el:"#userCardPlaceholder",model:e});r.render();var i=new n({el:"#global_nav_tabs_container",model:e})})});