function API(e){e=e||{},this.baseUrl=e.base||"/_ajax/",this.reqsInProgress={},this.init()}function SearchBox(e){this.SELECT_CLICK="click",this.SELECT_UP="up",this.SELECT_DOWN="down",this.SELECT_ENTER="enter",this.DROPDOWN_AUTO_SUGGEST="auto suggest",this.DROPDOWN_HISTORY="history";var t=function l(){},i=e.searchInputSelector||".searchInput",o=e.textTriggerSelector||".textDropdownTrigger",a=e.dropdownSelector||".dropdownBox",n=e.autoSuggestListSelector||".autoSuggestList",r=e.historyListSelector||".historyList";e=e||{},this.container=e.container,this.input=this.container.find(i),this.textTrigger=this.container.find(o),this.dropdown=this.container.find(a),this.autoSuggestList=this.container.find(n),this.historyList=this.container.find(r),this.data=e.data,this.data.datalist&&(this.dataList=_.debounce(this.data.datalist,200)),this.dropdownWidth=e.dropdownWidth||"100%",this.autoSuggestItemTemplate=e.autoSuggestItemTemplate||_.template($("#autoSuggestItemTemplate").html()),this.emptyListItemTemplate=e.emptyListItemTemplate||_.template($("#emptyListItemTemplate").html()),this.backup={value:this.input.val()},this.listeners={select:e.onSelect||t,dropdown:e.onDropdown||t,deactivate:e.onDeactivate||t,init:e.onInit||t},this.init()}function GlobalNav(e){e=e||{},this.loggedIn=!!e.loggedIn||!1,this.showSearch=!!e.showSearch||!0,this.logoBox=e.logoBox||".globalNavLogo",this.searchBox=e.searchBox||".globalNavSearch",this.linkItem=e.linkItem||".globalNavSearch",this.tracking=e.tracking||function(){},this.modules=e.modules||{},this.container=e.container?"string"==typeof e.container?$(e.container):e.container:$(".globalNav"),this.init()}API.prototype.init=function e(){},API.prototype.get=function t(e,i,o){return 2==arguments.length&&"function"==typeof i&&(o=i,i={}),this.passthru(this.baseUrl+e,i,o)},API.prototype.passthru=function i(e,t,o){var a=this;$.ajax({url:e,dataType:"json",type:"get",data:$.extend(t,{_random:+new Date}),error:function(e){o(e?e:a._error)},success:function(e){return e.success?void o(null,e):o(e.errors?e.errors:a._error)}})},API.prototype.autoSuggest=function o(e,t){return"string"==typeof e&&(e={query:e}),e.query?void this.get("AutoSuggest/AutoSuggest/",{query:e.query,types:e.types||["neighborhood","city","zipCode","county","address","street"],results:e.results||5,display:$("#globalSearchBox input[name=tst]").val()},function i(e,o){return e?t(e,o):(delete o.success,delete o.errors,void t(null,o))}):t("Query string is required")},API.prototype.geoCode=function a(e,t){return"string"==typeof e&&(e={address:e}),e.address?void this.passthru(CONST.siteRoot+"geocode/",{address:e.address},function i(e,o){return e?t(e,o):(delete o.success,delete o.errors,void t(null,o))}):t("Address is required")},API.prototype._error={message:"Unknown API error"},SearchBox.prototype.init=function(){var e=this;return e.preventClear=!1,e.dataList&&(this.dropdown.width(e.dropdownWidth),e.dropdown.on("mousedown",function(e){e.preventDefault(),e.stopImmediatePropagation()}),e.dropdown.on("mousedown","li",function(t){var i=$(this);t.preventDefault(),t.stopImmediatePropagation(),e.listeners.select.call(e,i,e.SELECT_CLICK)}),e.input.on("keydown",function(t){if(t.which==CONST.KEY_ENTER){var i=e.currentlyHighlighted;e.listeners.select.call(e,i,e.SELECT_ENTER),t.preventDefault(),e.hideDropdown()}else t.which==CONST.KEY_ESCAPE?(t.preventDefault(),e.undo(),e.hideDropdown(),e.listeners.deactivate.call(e)):t.which==CONST.KEY_ARROW_UP&&e.isDropdownActive()?(t.preventDefault(),e.highlightPrev(),e.container.one("mouseover",function(){e.autoSuggestList.addClass("listBorderedHover"),$(".listHoverItem",e.autoSuggestList).removeClass("listHoverItem"),e.currentlyHighlighted=null}),e.currentlyHighlighted.length&&e.listeners.select.call(e,e.currentlyHighlighted,e.SELECT_UP)):t.which!=CONST.KEY_ARROW_DOWN&&t.which!=CONST.KEY_TAB||!e.isDropdownActive()||(t.preventDefault(),e.highlightNext(),e.container.one("mouseover",function(){e.autoSuggestList.addClass("listBorderedHover"),$(".listHoverItem",e.autoSuggestList).removeClass("listHoverItem"),e.currentlyHighlighted=null}),e.currentlyHighlighted.length&&e.listeners.select.call(e,e.currentlyHighlighted,e.SELECT_DOWN))}),e.input.on("keyup",function(t){t.which==CONST.KEY_ENTER||t.which==CONST.KEY_ESCAPE||t.which==CONST.KEY_TAB||t.which==CONST.KEY_ARROW_LEFT||t.which==CONST.KEY_ARROW_UP||t.which==CONST.KEY_ARROW_RIGHT||t.which==CONST.KEY_ARROW_DOWN&&e.isDropdownActive()||e.queryForSuggest()})),e.textTrigger.on("click",function(t){e.updateAutoSuggestList(""),e.showDropdown(e.DROPDOWN_HISTORY),e.container.triggerHandler("searchbox:textTriggerClick",{}),t.stopPropagation(),$(document).on("click.searchBoxDropDown",function(t){e.dropdown.is(t.target)||0!==e.dropdown.has(t.target).length||(e.hideDropdown(),$(document).off("click.searchBoxDropdown"))})}),e.input.on("blur",function(){e.hideDropdown(),e.listeners.deactivate.call(e)}),e.input.on("focus",function(e){_.defer(function(){trulia.browser.isMSIE&&trulia.browser.version<=8?e.target.select():e.target.setSelectionRange(0,9999)})}),e.dropdown.css("transition","none"),e.listeners.init.call(e),this},SearchBox.prototype.queryForSuggest=function(){var e=this,t=this.input.val();e.data&&"function"==typeof e.dataList&&(t.length>(e.data.minLength?e.data.minLength-1:0)?e.dataList.call(e,t,function(i,o){e.updateAutoSuggestList(o,t),e.showDropdown(e.DROPDOWN_AUTO_SUGGEST)}):(e.updateAutoSuggestList(),e.hideDropdown()))},SearchBox.prototype.showDropdown=function(e){return e!==this.dropdownState&&(this.container.toggleClass("autoSuggestDropdown",e===this.DROPDOWN_AUTO_SUGGEST),this.container.toggleClass("searchHistoryDropdown",e===this.DROPDOWN_HISTORY)),this.isDropdownActive()&&e===this.dropdownState?void(this.autoSuggestList.children().length<1&&(!this.historyList.length||this.historyList.children().length<1)&&this.hideDropdown()):(this.dropdown.parent().addClass("dropdownHover"),this.dropdownState=e,void this.listeners.dropdown.call(this,e))},SearchBox.prototype.hideDropdown=function(){this.dropdown.length>0&&this.dropdown.parent().removeClass("dropdownHover")},SearchBox.prototype.isDropdownActive=function(){return this.dropdown.length>0&&this.dropdown.parent().hasClass("dropdownHover")},SearchBox.prototype.undo=function(){"undefined"!=typeof this.backup.value&&this.value(this.backup.value)},SearchBox.prototype.value=function(e){return"undefined"!=typeof e&&_.isString(e)&&this.input.val(e.replace(/_/g," ")),this.input.val()},SearchBox.prototype.updateTextTrigger=function(e){this.textTrigger.html(e),this.textTrigger.toggleClass("hideVisually",0===e.length)},SearchBox.prototype.updateHistoryList=function(e){this.historyList.html(e),this.historyList.toggleClass("hideVisually",0===e.length)},SearchBox.prototype.updateAutoSuggestList=function(e,t){var i=[];if($.isArray(e)&&e.length>0){i.push(this.emptyListItemTemplate());for(var o=0;o<e.length;o++)e[o].display=e[o].title.replace(new RegExp("(^|)("+t+")(|$)","i"),"$1<b>$2</b>$3"),e[o].titleWidth=Math.max(320,this.container.width()-75),i.push(this.autoSuggestItemTemplate(e[o]));i.push(this.emptyListItemTemplate())}this.autoSuggestList.html(i.join(""))},SearchBox.prototype.highlightNext=function(){this.currentlyHighlighted&&0!==this.currentlyHighlighted.length?(this.currentlyHighlighted=this.currentlyHighlighted.next("li"),0===this.currentlyHighlighted.children().length&&(this.currentlyHighlighted=$("li",this.autoSuggestList).first().next("li"))):this.currentlyHighlighted=$("li",this.autoSuggestList).first().next("li"),this._highlightElement(this.currentlyHighlighted)},SearchBox.prototype.highlightPrev=function(){this.currentlyHighlighted&&0!==this.currentlyHighlighted.length?(this.currentlyHighlighted=this.currentlyHighlighted.prev("li"),0===this.currentlyHighlighted.children().length&&(this.currentlyHighlighted=$("li",this.autoSuggestList).last().prev("li"))):this.currentlyHighlighted=$("li",this.autoSuggestList).last().prev("li"),this._highlightElement(this.currentlyHighlighted)},SearchBox.prototype._highlightElement=function(e){this.autoSuggestList.removeClass("listBorderedHover"),this.autoSuggestList.addClass("listBordered"),$(".listHoverItem",this.autoSuggestList).removeClass("listHoverItem"),e&&e.addClass("listHoverItem")},trulia.config=trulia.config||{},trulia.config.filters=trulia.config.filters||{},trulia.config.filters.locations={editable:!0,title:"Locations",minLength:3,maxCacheSize:50,types:"srp"===trulia.page_name||"details"===trulia.page_name?["neighborhood","city","zipCode","county","address","street","community"]:["neighborhood","city","zipCode","county"],datalist:function(e,t){var i=this,o=e;if("undefined"==typeof i.autoSuggestCache)i.autoSuggestCache=[];else for(var a=0;a<i.autoSuggestCache.length;a++)if(o===i.autoSuggestCache[a].query)return t(i.autoSuggestCache[a].result.length?null:"no locations",i.autoSuggestCache[a].result);var n={types:i.data.types,query:e};trulia.api.autoSuggest(n,_.debounce(function(e,a){var n,r,l=[],c;if(e||!a.locations)return t(e||"no locations");for(n=0;n<a.locations.length;n++){switch(r=null,c=a.locations[n],c.type){case"city":r={value:i.data.cityToValue(c.display)+"_city",title:c.display,suffix:"City",locationId:c.value,pid:"",propertyIndex:""};break;case"neighborhood":r={value:c.altValue+"_nh",title:c.display,suffix:"Neighborhood",locationId:c.value,pid:"",propertyIndex:""};break;case"county":r={value:c.altValue+"_c",title:c.display,suffix:"County",locationId:c.value,pid:"",propertyIndex:""};break;case"zipCode":r={value:c.altValue+"_zip",title:c.display,suffix:"Zip",locationId:c.value,pid:"",propertyIndex:""};break;case"address":r={value:c.value?c.value:!0,title:c.display,suffix:"Address",locationId:c.value,pid:c.value,propertyIndex:c.propertyIndex?c.propertyIndex:""};break;case"community":r={value:c.value?c.value:!0,title:c.display,suffix:"Community",locationId:c.value,pid:c.value,propertyIndex:c.propertyIndex?c.propertyIndex:""};break;case"street":r={value:!0,title:c.display,suffix:"Street",locationId:"",pid:"",propertyIndex:""}}r&&(r.ac_index=c.index,r.locationType=c.type,l.push(r))}return i.autoSuggestCache.length>=i.data.maxCacheSize&&i.autoSuggestCache.pop(),i.autoSuggestCache.splice(0,0,{query:o,result:l}),t(l.length?null:"no locations",l)}),200)},cityToValue:function(e){return e?(""+e).replace(", ",",").replace(/\s+/g,"_"):""}},trulia.config=trulia.config||{},trulia.config.filters=trulia.config.filters||{},trulia.config.filters.keywords={editable:!0,title:"Keywords",validate:function n(e){return(e=(""+e).replace(/, /g,",").replace(/ /g,"+").toLowerCase())?e:!1},format:function r(e){return e.replace(/,/g,", ").replace(/_|\+/g," ")}},"undefined"==typeof trulia&&(trulia={}),trulia.mixin=trulia.mixin||{},trulia.mixin.withEvents=function l(){var e,t={};this.notify=function i(e,o){var a,n=0;if(t[e])for(a=0;a<t[e].length;a++)if(t[e][a]){if(t[e][a].call(this,o)===!1)return!1;n++}return n},this.listen=e=function o(i,a,n){var r,l,c;if("string"!=typeof i||"function"!=typeof a)return!1;if(i.indexOf(" ")>-1){for(l=i.split(" "),r=0;r<l.length;r++)c=e(l[r],a,n);return c}return t[i]||(t[i]=[]),t[i].push(n?function(e){var t=this;setTimeout(function(){a.call(t,e)},0)}:a),t[i].length-1},this.removeListener=function a(e,i){var o,a=!1;if(!e||!t[e])return!1;if("function"==typeof i){for(o=0;o<t[e].length;o++)if(t[e][o]==i){a=t[e][o],t[e][o]=null;break}}else"number"==typeof i&&t[e][i]&&(a=t[e][i],t[e][i]=null);return a},this.getListeners=function n(){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}},"undefined"==typeof trulia&&(trulia={}),trulia.mixin=trulia.mixin||{},trulia.mixin.withLinks=function c(){var e,t={};this.processTrack=function i(e){var t;return"function"!=typeof this.tracking?!1:void((t=$(e).attr("data-track"))&&this.tracking(t,e))},this.processAction=function o(e,t){var i;(i=$(e).attr("data-action"))&&(i=unescape(i),t&&(trulia.browser.isMac&&t.metaKey||!trulia.browser.isMac&&t.ctrlKey)?window.open(i,"_blank"):document.location=i)},this.linkHasRole=function a(e,t){return $(e).is("[data-role~="+t+"]")}},trulia.mixin.withEvents.apply(GlobalNav.prototype),trulia.mixin.withLinks.apply(GlobalNav.prototype),GlobalNav.prototype.init=function h(){var e=this,t=document.body;trulia.browser.isIOS&&(this.container.on("touchstart",".dropdown",function(e){$(this).addClass("dropdownHover")}),this.container.on("touchend",".dropdown",function(e){var t=this;setTimeout(function(){$(t).removeClass("dropdownHover")},500)})),this.container.on("click","[data-role~=global_nav_link]",function(t){return e.notify("link:clicked",{el:this})===!1?(t.preventDefault(),!1):(e.processTrack(this),void e.processAction(this,t))})},trulia.ready(function(){var e,t,i;"undefined"!=typeof GlobalNav&&(e=new GlobalNav({tracking:trulia.tracking.raptorbar}),e.listen("link:clicked",function(e){var t=["Mortgage","Mortgage|Mortgage","Mortgage|HomeLoan","Mortgage|Refinance"];if($(e.el).parents("[data-role~=global_nav_menu_item__mortgage]")&&$.inArray($(e.el).attr("data-track"),t)>-1){var i=build_cookie_exp_date(1);setCookie("mrtg_navcl","1",i)}}),"undefined"!=typeof s_account&&"function"==typeof s_gi&&(i=s_gi(s_account))&&i.pageName&&$("[data-role~=global_nav_menu_submenu_item__sls]",e.container).each(function(e,t){var o,a="s_pageName="+escape(i.pageName);t=$(t),o=t.attr("href"),o?t.attr("href",o+(-1===o.indexOf("?")?"?"+a:"&"+a)):(o=t.attr("data-action"),o&&t.attr("data-action",o+escape(-1===unescape(o).indexOf("?")?"?"+a:"&"+a)))}),$("[data-ignore-filters]").on("click",function(){setCookie("ignore_filters",1)}),setCookie("ignore_filters",0),trulia.globalNav=e)}),trulia.ready(function(){var e,t,i=$("#noLocationPixel");trulia.api=trulia.api||new API({base:site_root+"_ajax/"}),(t=$("#globalSearchBox")).length&&(e=new SearchBox({container:t,data:t.find(".searchInput").hasClass("searchByKeyword")?trulia.config.filters.keywords:trulia.config.filters.locations,dropdownWidth:"107%",onSelect:function(e,t){if("undefined"!=typeof e||t!==this.SELECT_ENTER){e=$(e);var o=e.data();if(o.targetUrl)t===this.SELECT_CLICK&&(this.searchHistoryTrackingHandler(this.dropdownState,o.searchType),this.hideDropdown(),window.location.href=site_root+o.targetUrl);else if(e.data("title")&&e.data("value")){var a=this.value();if(this.value(e.data("title")),t===this.SELECT_CLICK||t===this.SELECT_ENTER){$(this.container).find('input[name="ac_entered_query"]').val(a);var o=e.data(),n=$(this.container);if(_.each(o,function(e,t){var i=n.find('input[name="'+t+'"]');i.length>0?i.val(e):n.append('<input type="hidden" name="'+t+'" value="'+e+'">')}),this.hideDropdown(),i.length){$("#noLocationPixel").attr("src",i.attr("src")+"&no_location_action=new_search|"+this.value());var r=this.container;setTimeout(r.submit,100)}else this.container.submit()}}}else if(this.value())if(i.length){var r=this.container;i.attr("src",i.attr("src")+"&no_location_action=new_search|"+this.value()),setTimeout(r.submit,100)}else this.container.submit()},onDropdown:function(e){return this.textTrigger.length?(this.updateHistoryList(e===this.DROPDOWN_AUTO_SUGGEST?this.recentSearchesHTML:this.savedSearchesHTML),e===this.DROPDOWN_HISTORY&&this.savedSearchesCount<1?(this.container.removeClass("autoSuggestDropdown").removeClass("searchHistoryDropdown"),this.container.addClass("shortContentDropdown")):this.container.removeClass("shortContentDropdown"),this.autoSuggestList.children().length<1&&this.historyList.children().length<1?this.hideDropdown():($("#searchHistoryTab").length&&($("#searchHistoryTab").truliaTabs(),(trulia.propertyData&&trulia.propertyData.get().isRental||trulia.srp&&trulia.srp.isRental)&&$("#searchHistoryTab").truliaTabs("select",1)),this.textTrigger.tooltip("hide"),void(this.tooltipTimeout&&clearTimeout(this.tooltipTimeout)))):void(this.autoSuggestList.children().length<1&&this.hideDropdown())},onInit:function(){if(this.textTrigger.length){var e=this;e.maxListSize=5,e.tooltipVisibleDuration=4e3,e.savedSearchesCount=0,e.textTrigger.tooltip({trigger:"none",offset:"-9x0",anchor:"bottomright",content:"Saved!"});var t=function(t,i){e.hideDropdown(),trulia.api.get("GlobalNav/MySearches/"+t+"/?max_list_size="+e.maxListSize,function(t,o){t||("string"==typeof o.saved_searches_html&&(e.savedSearchesHTML=o.saved_searches_html,e.savedSearchesCount=parseInt(o.saved_searches_count,10),e.updateTextTrigger(o.saved_searches_count+" SAVED &#x25bc;"),i&&(e.tooltipTimeout&&clearTimeout(e.tooltipTimeout),e.textTrigger.tooltip("show"),e.tooltipTimeout=setTimeout(function(){e.textTrigger.tooltip("hide"),e.tooltipTimeout=null},e.tooltipVisibleDuration))),"string"==typeof o.recent_searches_html&&(e.recentSearchesHTML=o.recent_searches_html))})};t.call(e,"get_my_searches"),e.container.on("searchbox:textTriggerClick",function(e){_trulia_logged_in||o_track_ql_click("searchBarSaves_noSaved")}),e.dropdown.on("click","#searchBoxCreateAccountBtn",function(t){t.preventDefault(),trulia.AuthPopup.show({forceShowRegister:!0,registrationSource:"search_box_saved_search"}),e.hideDropdown(),o_track_ql_click("searchBarSaves_createAccount")}),e.dropdown.on("nav:change","#searchHistoryTab",function(t,i,o){e.tabChangeTrackingHandler(e.dropdownState,o)}),e.dropdown.on("click","#viewMoreSearches",function(){o_track_ql_click(e.dropdownState===e.DROPDOWN_HISTORY?"searchBarSaves_seeMore":"searchBarRecent_seeMore")}),$(document).on("saved.saveSearch saved.deleteSearch searches.deleteAllSaved alerts.saveSearchAlertOptions completeEmailAlertSignup",function(i){var o="saved"==i.type||"completeEmailAlertSignup"==i.type||"alerts"==i.type;t.call(e,"get_saved_searches",o)}),$(document).on("loggedIn.auth completeRegister.auth searches.saveRecentSearch searches.deleteSearch loggedOut.auth",function(){t.call(e,"get_my_searches")}),e.searchHistoryTrackingHandler=function(e,t){var i=[];i[this.DROPDOWN_AUTO_SUGGEST+CONST.PROPERTY_STATUS_FOR_SALE.toLowerCase()]="searchBarRecent_forSaleSearch",i[this.DROPDOWN_AUTO_SUGGEST+CONST.PROPERTY_STATUS_FOR_RENT.toLowerCase()]="searchBarRecent_rentSearch",i[this.DROPDOWN_HISTORY+CONST.PROPERTY_STATUS_FOR_SALE.toLowerCase()]="searchBarSaves_forSaleSearch",i[this.DROPDOWN_HISTORY+CONST.PROPERTY_STATUS_FOR_RENT.toLowerCase()]="searchBarSaves_rentSearch",o_track_ql_click(i[e+t])},e.tabChangeTrackingHandler=function(e,t){var i=[];i[this.DROPDOWN_HISTORY+0]="searchBarSaves_forSaleTab",i[this.DROPDOWN_HISTORY+1]="searchBarSaves_rentTab",i[this.DROPDOWN_AUTO_SUGGEST+0]="searchBarRecent_forSaleTab",i[this.DROPDOWN_AUTO_SUGGEST+1]="searchBarRecent_rentTab",o_track_ql_click(i[e+t])}}}}),e.input.on("keyup",function(){var e=$(this).val();$(window).triggerHandler({type:"searchbox:change",searchbox_val:e})}).on("focus",function(){trulia.track({props:{33:s.pageName+"|globalNav|search_input|focus"}})}),t.on("submit",function(){trulia.track({props:{33:s.pageName+"|globalNav|search_form|submit"}})}),trulia.pubsub.on("filterModel:locationChange",function(t){t.hasOnlyDefaultCity()&&e.value(t.get("city")[0])}),$(window).on("searchbox:change",function(t){e.input.val()!==t.searchbox_val&&e.input.val(t.searchbox_val)}))}),trulia.ready(function(){var e=$("#searchLocationContainer");if(e.length){var t,i,o=e.find("#searchLocation");o.on("click",function(a){return e.hasClass("searchBox")?(o.addClass("hideFully"),i.removeClass("hideFully"),void i.focus()):(i=e.find(".searchInput"),e.addClass("searchBox"),o.addClass("hideFully"),i.removeClass("hideFully"),t=new SearchBox({container:e,data:trulia.config.filters.locations,dropdownWidth:400,onSelect:function(e,t){e&&e.data("title")&&e.data("value")&&(this.value(e.data("title")),(t===this.SELECT_CLICK||t===this.SELECT_ENTER)&&(this.hideDropdown(),o.text(this.value()),o.removeClass("hideFully"),i.addClass("hideFully"),$("#globalSearchBox").find('input[name="search"]').val(this.value()),$("#globalSearchBox").submit()))},onDropdown:function(){this.autoSuggestList.children().length<1&&this.hideDropdown()},onDeactivate:function(){this.undo(),o.removeClass("hideFully"),i.addClass("hideFully")}}),i.focus(),void a.preventDefault())})}}),trulia.ready(function(){if($('[data-role~="dropdown_container"]').length){var e=getCookie("SSOE"),t=getCookie("ss_lsc"),i=1==t||e&&$.inArray("6",e.split(":"))>-1,o={myHomesTracking:"globalHomesIcon",mySearchesTracking:"globalSearchesIcon"},a=Backbone.Model.extend({defaults:{propertyId:"",isRental:"",address:"",addressShort:"",pdpUrl:"",thumbnail:"",photoUrl:"",formattedPrice:"",formattedBedAndBath:"",formattedSqft:"",shortDescription:"",topTitle:"",description:""},idAttribute:"propertyId",initialize:function(){this.setTopTitle(),this.setDescription()},setTopTitle:function(){var e=[];this.get("isRental")&&""!==this.get("formattedPrice")&&e.push(this.get("formattedPrice")),e.push(this.get("isRental")&&""!==this.get("shortDescription")?this.get("shortDescription"):this.get("address")),this.set("topTitle",e.join(" | "))},setDescription:function(){var e=[];this.get("isRental")||""===this.get("formattedPrice")||e.push(this.get("formattedPrice")),""!==this.get("formattedBedAndBath")&&e.push(this.get("formattedBedAndBath")),""!==this.get("formattedSqft")&&e.push(this.get("formattedSqft")),this.set("description",e.join(", "))}}),n=Backbone.Collection.extend({model:a,fetched:!1,url:null,LIMIT:3,parse:function(e){return e.success?_.map(e.properties,function(e){return{propertyId:e.propertyId,isRental:e.isRental,address:e.addressForDisplay,addressShort:e.addressShort,pdpUrl:e.pdpURL,thumbnail:e.thumbnail,photoUrl:e.photoURL,formattedPrice:e.formattedPrice,shortDescription:e.shortDescription,formattedBedAndBath:e.formattedBedAndBath,formattedSqft:e.formattedSqft}}):{}},pushProperty:function(e){this.unshift(e),this.length>this.LIMIT&&(this.models=this.first(this.LIMIT))},removeById:function(e){this.remove(this.where({propertyId:e}))},hasFetched:function(){return this.fetched}}),r=n.extend({url:site_root+"_ajax/GlobalNav/MyProperty/get_saved_rental_properties/"}),l=n.extend({url:site_root+"_ajax/GlobalNav/MyProperty/get_followed_properties/"}),c=n.extend({url:site_root+"_ajax/GlobalNav/MyProperty/get_recommended_properties/?limit=5",limit:5}),h=Backbone.View.extend({el:"#savedPropertyList ul",template:_.template($("#propertyRowTemplate").html()),events:{click:"loadProperty"},loadProperty:function(e){var t=this.model.get("isRental")?"Rent":"Buy";o_track_ql_click("StarMenu|"+t+"|ViewPDP"),window.location=this.model.get("pdpUrl")},render:function(){this.$el.append(this.template(this.model.toJSON())),this.setElement($("#"+this.model.get("propertyId")))}}),d=h.extend({el:"#suggestedPropertyList ol",template:_.template($("#suggestedPropertyRowTemplate").html())}),u=Backbone.View.extend({el:"#suggestedPropertyContainer",listSelector:"#suggestedPropertyList",titleSelector:".propertyBoxPropertyTitle",descriptionSelector:".propertyBoxPropertyType",emptyTemplate:_.template($("#suggestedPropertyEmptyContainerTemplate").html()),template:_.template($("#suggestedPropertyContainerTemplate").html()),suggestedHomesLinkTemplate:_.template($("#suggestedHomesLinkTemplate").html()),events:{"mouseover .starMenuCarouselImage":"toggleOverlay","mouseout .starMenuCarouselImage":"toggleOverlay","click #viewAllSuggestedHomesLink":"trackViewAllSuggested","click #viewAllSuggestedHomesSlide":"trackViewAllSuggested","click #suggestedPropertyList .prev":"trackCarouselNavigation","click #suggestedPropertyList .next":"trackCarouselNavigation","click .overlayContainer":"trackIndividualSuggstedHome"},toggleOverlay:function(e){$(e.currentTarget).find("a .overlayLowlight").toggleClass("hideVisually","mouseout"===e.type)},render:function(){return this.collection.length<1?void this.$el.html(this.emptyTemplate()):(this.$el.html(this.template()),this.collection.each(function(e){new d({model:e}).render()}),this.$el.find("ol").append(this.suggestedHomesLinkTemplate({site_root:site_root})),void $(this.listSelector+" .carousel").carousel({pageMode:!0,perPage:2,slideWidth:133,prevSelector:this.listSelector+" .prev",nextSelector:this.listSelector+" .next",disabledClass:"btnDisabled"}))},trackViewAllSuggested:function(e){o_track_ql_click("StarMenu|"+$(e.target).data("trackingString"))},trackCarouselNavigation:function(e){var t="Next";$(e.currentTarget).hasClass("prev")&&(t="Prev"),o_track_ql_click("StarMenu|Suggested|Carousel|"+t)},trackIndividualSuggstedHome:function(e){o_track_ql_click("StarMenu|Suggested|ViewPDP")}}),p=Backbone.View.extend({el:"#propertyDropdownBody",rentTab:"Rent",buyTab:"Buy",rendered:!1,rentTabHeaderText:"Saved Homes",buyTabHeaderText:"Saved Homes",buyTabHeaderLinkText:"View All",rentTabHeaderLinkText:"",forSaleSuccessMessage:"Success! You have just saved this home.",forRentSuccessMessage:"Success! You saved a new rental.",activeTab:null,savedHomesLink:"account/properties/forrent",lscLink:"saved-homes",template:null,myPropertyContainerTemplate:_.template($("#myHomesContainerTemplate").html()),loggedOutOrNoPropertyContainerTemplate:_.template($("#loggedOutOrNoPropertyContainerTemplate").html()),savedRentalFooterTemplate:_.template($("#savedRentalContainerFooterTemplate").html()),myPropertyActiveTabTemplate:_.template($("#myHomesActiveTab").html()),myPropertyInactiveTabTemplate:_.template($("#myHomesInactiveTab").html()),headerSelector:"#globalNavMyHomesTabHeader",footerSelector:"#globalNavMyHomesFooter",savedMessageSelector:"#starMenuSavedMessage",SavedPropertyCollection:null,FollowedPropertyCollection:null,SuggestedPropertyCollection:null,events:{"click .viewSavedProperties":"trackViewSavedProperty","click #viewAllFollowedHomesLink":"trackViewAllFollowedHomes","click #globalNavMyHomesTabHeader a":"changeTab"},trackViewSavedProperty:function(e){e.preventDefault(),o_track_ql_click("TopNav|LeadShoppingCart|Click|ViewAllSavedProperties"),setTimeout(function(){window.location=e.target.href},100)},trackViewAllFollowedHomes:function(e){o_track_ql_click("StarMenu|ViewAllFollowedHomes")},changeTab:function(e){var t=$(e.target).data("tab");e.preventDefault(),this.activeTab=t,this.render(),o_track_ql_click("StarMenu|"+t+"Tab")},initialize:function(){var e=this;e.SavedPropertyCollection=new r,e.FollowedPropertyCollection=new l,e.SuggestedPropertyCollection=new c,$(document).on("followAction.followHome",_.bind(e.followHomeCallback,this)),this.activeTab="undefined"!=typeof trulia.srp&&1==trulia.srp.isRental||trulia.propertyData&&trulia.propertyData.get().isRental?this.rentTab:this.buyTab,e.viewAllRentalHomesLink=i?e.lscLink:e.savedHomesLink},errorHandler:function(e,t){e.hasOwnProperty(trulia.errors.AUTH_MUST_LOG_IN)?(trulia.auth.logout(),this.$el.html(this.loggedOutOrNoPropertyContainerTemplate({is_logged_in:!1}))):e.hasOwnProperty(trulia.errors.ERROR_API_RESPONSE)?t.reset():this.$el.html("")},fetchData:function(){var e=this;e.rendered=!1,e.SavedPropertyCollection.fetch({success:function(t,i){t.fetched=!0,i.success||e.errorHandler(i.errors,this),e.rendered||(e.render(),e.flashInitialSuccessMessage()),e.renderTabSelector()}}),e.FollowedPropertyCollection.fetch({success:function(t,i){t.fetched=!0,i.success||e.errorHandler(i.errors,this),e.rendered||(e.render(),e.flashInitialSuccessMessage()),e.renderTabSelector()}}),e.SuggestedPropertyCollection.fetch({success:function(t,i){t.fetched=!0,i.success||e.errorHandler(i.errors,this),(e.activeTab===e.buyTab||e.rendered&&0===e.SavedPropertyCollection.length)&&e.renderSuggestedHomes()}})},followHomeCallback:function(e,t,i){"follow"===i?this.addPropertyToCollection(e,t,i):this.removePropertyFromCollection(e,t,i)},addPropertyToCollection:function(e,t,i){var o=new a({propertyId:t.id,isRental:t.isRental,address:t.addressForDisplay,pdpUrl:t.pdpURL,thumbnail:t.thumbnail,formattedPrice:t.formattedPrice,shortDescription:t.shortDescription,formattedBedAndBath:t.formattedBedAndBath,formattedSqft:t.formattedSqft}),n=this;t.isRental?(this.SavedPropertyCollection.pushProperty(o),this.activeTab=this.rentTab,this.SavedPropertyCollection.fetch().done(function(){n.render(),n.showSucessMessage()})):(this.FollowedPropertyCollection.pushProperty(o),this.activeTab=this.buyTab,this.FollowedPropertyCollection.fetch().done(function(){n.render(),n.showSucessMessage()}))},removePropertyFromCollection:function(e,t,i){t.isRental?this.SavedPropertyCollection.removeById(t.id):this.FollowedPropertyCollection.removeById(t.id),this.render()},showSucessMessage:function(){this.$el.find(this.savedMessageSelector).fadeIn().delay(2e3).fadeOut()},flashInitialSuccessMessage:function(){O.flashInitialSuccessMessage&&(this.showSucessMessage(),O.flashInitialSuccessMessage=!1)},render:function(){var e,t,i;if(this.SavedPropertyCollection.length>0&&this.activeTab===this.rentTab||this.FollowedPropertyCollection.length>0&&this.activeTab===this.buyTab)this.template=this.myPropertyContainerTemplate;else{if(!this.FollowedPropertyCollection.hasFetched()||!this.SavedPropertyCollection.hasFetched())return;this.template=this.FollowedPropertyCollection.length<1&&this.SavedPropertyCollection.length<1?this.loggedOutOrNoPropertyContainerTemplate:this.myPropertyContainerTemplate}this.rendered=!0,e=this.activeTab===this.rentTab&&this.SavedPropertyCollection.length>0||0===this.FollowedPropertyCollection.length,this.$el.html(this.template({site_root:site_root,is_logged_in:!0,header:e?this.rentTabHeaderText:this.buyTabHeaderText,viewAllLinkText:e?this.rentTabHeaderLinkText:this.buyTabHeaderLinkText})),i=this.$el.find(this.savedMessageSelector),e?(t=this.SavedPropertyCollection,i.text(this.forRentSuccessMessage),this.$el.find(this.footerSelector).html(this.savedRentalFooterTemplate({viewAllRentalHomesLink:site_root+this.viewAllRentalHomesLink}))):(t=this.FollowedPropertyCollection,i.text(this.forSaleSuccessMessage),this.renderSuggestedHomes()),t.each(function(e){new h({model:e}).render()}),this.renderTabSelector()},renderTabSelector:function(){$(this.headerSelector).children().length>0||this.SavedPropertyCollection.length>0&&this.FollowedPropertyCollection.length>0&&(this.activeTab===this.rentTab?$(this.headerSelector).append(this.myPropertyActiveTabTemplate({tabName:this.buyTab})).append(this.myPropertyInactiveTabTemplate({tabName:this.rentTab})):$(this.headerSelector).append(this.myPropertyInactiveTabTemplate({tabName:this.buyTab})).append(this.myPropertyActiveTabTemplate({tabName:this.rentTab})))},renderSuggestedHomes:function(){this.FollowedPropertyCollection.length>0&&new u({collection:this.SuggestedPropertyCollection}).render()}}),g=Backbone.View.extend({initialize:function(){var e=this;e.render(),$(document).on("loggedIn.auth",function t(){e.render()}),$(document).on("loggedOut.auth",function i(){e.render()})},render:function(){var e=this;e.renderContainer(),e.listenTo(e.container,"rerender",e.render),e.listenTo(e.container,"dropdown:autoShowAndHide",function(){e.trigger("dropdown:autoShowAndHide")}),e.listenTo(e.container,"dropdown:show",function(){e.trigger("dropdown:show")}),e.listenTo(e.container,"dropdown:hide",function(){e.trigger("dropdown:hide")})},renderContainer:function(){if(g.shouldShowFirstTimeNudge()){var e=this;return e.container=new C,e.container.render(),void setTimeout(function(){e.trigger("dropdown:show")},5e3)}return _trulia_logged_in?(this.container=new b,this.container.render(),this.container=new p,void this.container.fetchData()):(this.container=new w,void this.container.render())}},{COOKIE_NAME:"globalnav.starmenu.hide_nudge",shouldShowFirstTimeNudge:function(){var e="undefined"!=typeof trulia.srp&&trulia.srp.isRental,t=e&&"large_map"!=trulia.page_name;return i&&t&&1!=getCookie("globalnav.starmenu.hide_nudge")}}),f=null,m=Backbone.View.extend({cookieName:"icon_badges",cookieObj:{},containerID:null,shown:!1,events:function(){this.listenTo(trulia.LegacyEventWrapper($(document)),"loggedIn.auth",this.hideBadge),this.listenTo(trulia.LegacyEventWrapper($(document)),"completeRegister.auth",this.hideBadge),this.listenTo(trulia.LegacyEventWrapper($(document)),"completeAutoRegister.auth",this.hideBadge)},initialize:function(e,t){_.bindAll(this,"hideBadge"),this.el=$('[data-role="notify_badge"]',e),this.containerID=t,this.showOrHideBadge()
},setCookieObj:function(){var e=this.getCookieObj();_.isEmpty(e)||(this.cookieObj=e)},getCookieObj:function(){var e=getCookie(this.cookieName);return"string"==typeof e?$.parseJSON(e):{}},showOrHideBadge:function(){this.setCookieObj(),getCookie("uex")||_.has(this.cookieObj,this.containerID)&&this.cookieObj[this.containerID]===!0?this.hideBadge():this.showBadge()},getValue:function(e){return this.cookieObj.key?this.cookieObj.key:!1},showBadge:function(){this.el.show(),this.cookieObj[this.containerID]=!1,setCookie(this.cookieName,JSON.stringify(this.cookieObj),build_cookie_exp_date()),this.shown=!0},hideBadge:function(){this.setCookieObj(),this.shown&&(this.el.hide(),this.cookieObj[this.containerID]=!0,setCookie(this.cookieName,JSON.stringify(this.cookieObj),build_cookie_exp_date()),this.shown=!1)}}),v=Backbone.View.extend({ContentView:null,timeout:null,isVisible:!1,badge:null,defaults:{delay:500,doShow:function(e){e.fadeIn(100)},doHide:function(e){e.fadeOut(100)}},events:{"click .triggerDropdown":"toggleDisplay"},initialize:function(){this.options=_.extend(this.defaults,this.options),this.options.lazy||this.initializeDropdown(),this.badge=new m(this.$el,this.options.name)},initializeDropdown:function(){this.ContentView=new this.options.contentView,this.listenTo(this.ContentView,"dropdown:show",this.show),this.listenTo(this.ContentView,"dropdown:hide",this.hide)},show:function(){this.initializeDropdown(),this.isVisible=!0,this.timeout?(clearTimeout(this.timeout),this.timeout=null):(this.options.doShow(this.$el.find(".dropdownContent")),trulia.pubsub.publish(this.options.name+":dropdown:visible"),this._toggleBackgroundColor(!0))},hide:function(){this.isVisible=!1;var e=this;e.timeout=setTimeout(function(){e.options.doHide(e.$el.find(".dropdownContent")),e.timeout=null,trulia.pubsub.publish(e.options.name+":dropdown:hidden"),e._toggleBackgroundColor(!1)},e.options.delay)},toggleIcon:function(e){this.options.iconStarTemplate&&$(".navIcon",this.el).html(this.options.iconStarTemplate({iconToggleClass:e?this.options.icons.active:this.options.icons.base}))},toggleDisplay:function(e){if(this.isVisible)this.hide();else{var t=trulia.tracking.authFlowTracking.buildTrackingSuffixFromFlow(o[this.options.trackingId]);o_track_ql_click(this.badge.shown?t+"|Badge":t),this.badge.hideBadge(),null!==f&&f.isVisible&&f.hide(),f=this,this.show(),this._hideOnClickAway(e)}},_hideOnClickAway:function(e){var t=this;e.stopPropagation(),$(document).on("click.dropDownAway",function(e){if(!t.$el.is(e.target)&&0===t.$el.has(e.target).length){if(e.target.getAttribute("href")&&"#"==e.target.getAttribute("href"))return;t.hide(),$(document).off("click.dropDownAway")}})},_toggleBackgroundColor:function(e){var t="typeHighlight",i="linkLowlight";e?($(".triggerDropdown",this.$el).addClass(t),$(".triggerDropdown",this.$el).removeClass(i)):($(".triggerDropdown",this.$el).removeClass(t),$(".triggerDropdown",this.$el).addClass(i))}}),y=v.extend({VISIBLE_DURATION:5e3,flashInitialSuccessMessage:!1,defaults:_.extend({},v.prototype.defaults),initialize:function(){var e=this;v.prototype.initialize.apply(e,arguments),$(document).on("followAction.followHome",function(t,i,o){"follow"==o&&(e.flashInitialSuccessMessage=!0,e.autoShowAndHide())}),$(".globalNavStar").mouseover(function(e){o_track_ql_click("TopNav|LeadShoppingCart|OpenDropdown|Manually")})},initializeDropdown:_.once(function(){v.prototype.initializeDropdown.apply(this,arguments),this.listenTo(this.ContentView,"dropdown:autoShowAndHide",this.autoShowAndHide)}),autoShowAndHide:function(){var e=this,t=e.VISIBLE_DURATION-e.options.delay;e.show(),o_track_ql_click("TopNav|LeadShoppingCart|OpenDropdown|Auto"),e.timeout=setTimeout(function(){e.hide()},t)}}),S=Backbone.View.extend({loginCfg:{},events:{"click .signUpButton":"triggerLoginPopup"},triggerLoginPopup:function(e){e.preventDefault(),trulia.AuthPopup.show(this.loginCfg)},render:function(){this.$el.html(this.template({is_logged_in:!1}))}}),w=S.extend({el:"#propertyDropdownBody",template:_.template($("#loggedOutOrNoPropertyContainerTemplate").html()),initialize:function(){this.loginCfg={id:o.myHomesTracking,enableFlowUserClickTracking:!0}}}),T=S.extend({el:"#searchDropdownBody",template:_.template($("#loggedOutSearchContainerTemplate").html()),loginCfg:{id:o.mySearchesTracking,enableFlowUserClickTracking:!0}}),b=Backbone.View.extend({el:"#propertyDropdownBody",template:_.template($("#loadingSavedPropertiesContainerTemplate").html()),render:function(){this.$el.html(this.template())}}),C=Backbone.View.extend({el:"#propertyDropdownBody",template:_.template($("#firstTimeUserContainerTemplate").html()),events:{"click .btn":"hide"},initialize:function(){$(document).on("followAction.followHome",_.bind(this.followHomeCallback,this))},hide:function(){setCookie(g.COOKIE_NAME,1),this.trigger("rerender"),this.undelegateEvents(),o_track_ql_click("TopNav|LeadShoppingCart|FirstTimeNudge|Hide")},render:function(){this.$el.html(this.template()),o_track_ql_click("TopNav|LeadShoppingCart|FirstTimeNudge|AutoOpen")},followHomeCallback:function(e,t,i){var o=this;o.hide(),"follow"===i&&setTimeout(function(){o.trigger("dropdown:autoShowAndHide")},50)}}),k=Backbone.View.extend({initialize:function(){this.render();var e=this;$(document).on("loggedIn.auth",function(){e.trigger("dropdown:hide")})},render:function(){return this.container=new T,_trulia_logged_in?void this.clickThrough():void this.container.render()},clickThrough:function(){this.container.remove(),trulia.mixin.withLinks.apply(this),this.processAction($('[data-role~="ss_action"]'))}}),x=new v({name:"SearchDropdownView",trackingId:"mySearchesTracking",contentView:k,el:"#mySearchesDropdown",iconStarTemplate:_.template($("#iconWithBadgeTemplate").html()),lazy:!0,delay:100}),O=new y({name:"PropertyDropdownView",trackingId:"myHomesTracking",contentView:g,el:"#propertyDropdown",doHide:function(e){e.fadeOut(100),$(".globalNav").off("mouseover",".globalUserCardBadge")},doShow:function(e){e.fadeIn(100),$(".globalNav").on("mouseover",".globalUserCardBadge",function(e){null!==f&&f.hide()})},lazy:!g.shouldShowFirstTimeNudge(),delay:100});"function"!=typeof $().carousel&&$LAB.script("library/carousel/src/trulia.carousel.js")}}),trulia=trulia||{},trulia.GlobalNavSticky=function(){var e={target_id:"global-sub-nav",fade_duration:0},t=trulia.browser.isIpad||trulia.browser.isAndroid,i=trulia.browser.isMSIE&&trulia.browser.version<=8,o={};return o._sticky_enabled=!1,o._global_top_nav_height=0,o.init=function(e){var e=e||{};o.set_global_nav_sticky(),o.set_sticky_search(e),o.set_top_nav_height()},o.set_global_nav_sticky=function(){var e=$("[data-role=global_top_nav]");!e.length||$("body").hasClass("branded")||t||(e.sticky({scrollyOffset:3,toggleClass:"topNavSticky"}),o._sticky_enabled=!0)},o.set_sticky_search=function(i){var o=$("#globalSearchBox"),a=$("#topNavSearchContainer"),n=$("[data-role=left_nav_menu_item]"),r=$("#"+e.target_id),l=r.outerHeight(),c=r.parent(),h=c.height(),d=11;i=i||{},e.fade_duration=i.fade_duration||e.fade_duration,c.css("height",h-l-d),t||$(document).on("heroBanner_searchBox_hide",function(){o.stop(!0,!0).fadeIn(e.fade_duration),n.addClass("hideVisually"),o.appendTo(a).addClass("pts"),a.removeClass("hideVisually")}).on("heroBanner_searchBox_show",function(){o.stop(!0,!0).fadeOut(e.fade_duration),o.appendTo("#global_nav_searchbox").removeClass("pts"),a.addClass("hideVisually"),n.removeClass("hideVisually")})},o.set_top_nav_height=function(){var e=$("[data-role=global_top_nav]");o._global_top_nav_height=e.length?e.height():0},o.get_top_nav_height=function(){return o._global_top_nav_height},o.set_fade_duration=function(t){return e.fade_duration=t,o},o}();var initializeNavBarView=function(){AgentNav=Backbone.View.extend({initialize:function(e){this.el=e.el,this.template=e.template,this.site_root="undefined"!=typeof _SITE_ROOT&&_SITE_ROOT?_SITE_ROOT:site_root,this.listenTo(this.model,"change",this.render),this.listenTo(this.model,"sync",this.postSync)},events:{"change #searchOptions":"changeSearchAction","click #searchSubmit":"submitSearchForm","click #agentNavLogout":"agentNavLogout","click #navSearchOpen":"showSearchForm","click #navSearchClose":"hideSearchForm","click [data-omniture-click]":"trackOmniture","click #navCopySystemEmail":"copySystemEmail"},trackOmniture:function(e){var t=$(e.target).attr("data-omniture-click");_.isUndefined(t)||"undefined"==typeof o_track_ql_click||o_track_ql_click(t)},initSearchSuggestion:function(e){this.ac=$("form[name=navSearchForm] #searchText"),this.ac.autosuggest&&(this.ac.autosuggest({data:{types:["neighborhood","zipCode","city","county","address"]},display:{width_offset:-6,position_offset:{top:-2,left:2},tracking_string:"agentnav",allow_invalid:!0,submit_on_enter_select:!0,value_field:"input[name=locationId]"}}),this.ac.attr("autocomplete",""))},changeSearchAction:function(e){$("input[name=search]").attr("placeholder",$("#searchOptions option:selected").attr("data-search-text")),$("#searchText").val($("#searchOptions option:selected").attr("data-default-value")),$("#selectedSearchAction").html($("#searchOptions option:selected").html()),"m"==$("#searchOptions option:selected").attr("data-search-type")?($("#searchMsg").removeClass("hideVisually"),$("#searchMsg").show(),$("#searchContact").addClass("hideVisually"),$("#searchContact").hide(),$("#searchText").addClass("hideVisually"),$("#searchText").hide()):"b"==$("#searchOptions option:selected").attr("data-search-type")?($("#searchMsg").addClass("hideVisually"),$("#searchMsg").hide(),$("#searchContact").removeClass("hideVisually"),$("#searchContact").show(),$("#searchText").addClass("hideVisually"),$("#searchText").hide()):($("#searchMsg").addClass("hideVisually"),$("#searchMsg").hide(),$("#searchContact").addClass("hideVisually"),$("#searchContact").hide(),$("#searchText").removeClass("hideVisually"),$("#searchText").show())},submitSearchForm:function(){var e=$("#navSearchForm");$("input[name=tst]").val($("#searchOptions option:selected").attr("data-search-type")),$("input[name=display]").val($("#searchOptions option:selected").attr("data-search-display")),"m"==$("input[name=tst]").val()?e.attr("action",trulia.lead_inbox_page_url+"/#filter/?searchFilter="+encodeURIComponent($("input[name=searchMsg]").val())):"b"==$("input[name=tst]").val()?e.attr("action",trulia.lead_inbox_page_url+"/#filter/?contactSearchFilter="+encodeURIComponent($("input[name=searchContact]").val())):"a"==$("input[name=tst]").val()&&e.attr("action",trulia.agent_search_url),e.submit()},copySystemEmail:function(){if(document.selection){var e=document.body.createTextRange();e.moveToElementText(document.GetElementById("navAgentSystemEmail")),e.select()}else if(window.getSelection){var e=document.createRange();e.selectNodeContents(document.getElementById("navAgentSystemEmail")),window.getSelection().removeAllRanges(),window.getSelection().addRange(e)}$(".agentNavCopySystemEmailOutput").show(),setTimeout(function(){$(".agentNavCopySystemEmailOutput").hide()},5e3)},copySystemEmailSetup:function(){if($("#navAgentSystemEmail").length){var e=document.getElementById("navCopySystemEmail");e.width=$("#navCopySystemEmail").width(),e.height=$("#navCopySystemEmail").height(),e.zIndex=parseInt($(".dropdownBoxRight :first").css("z-index"))+1}},showSearchForm:function(){$(".navSearchFormContainer").fadeIn(100,function(){$("#searchText").focus(),$("#navSearchOpen").hide(),$("#agentBrowseTopNav").hide(),$("#agentAdvertiseTopNav").hide(),$("#agentSupportTopNav").hide()})},hideSearchForm:function(){$(".navSearchFormContainer").fadeOut(100,function(){}),$("#navSearchOpen").show(),$("#agentBrowseTopNav").show(),$("#agentAdvertiseTopNav").show(),$("#agentSupportTopNav").show()},render:function(){var e=this.template(this.model.attributes);return this.el.html(e),$("header").hide(),$("#globalNavNormal").remove(),$("#navbarAgent").show(),this.setupLogout(),this.initSearchSuggestion(),trulia.auth||$("#agentNavLogout").hide(),this},directBind:function(){trulia.LegacyEventWrapper&&this.listenTo(trulia.LegacyEventWrapper($(document)),"loggedOut.auth",this.routeAfterLogout),this.initSearchSuggestion(),this.postSync()},setupLogout:function(){trulia.LegacyEventWrapper&&this.listenTo(trulia.LegacyEventWrapper($(document)),"loggedOut.auth",this.routeAfterLogout)},postSync:function(){this.copySystemEmailSetup()},agentNavLogout:function(e){trulia.auth&&(e.preventDefault(e),trulia.auth.logout())},getPath:function(){return window.location.pathname.substring(site_root.length)},pageRequiresLogin:function(e){var t=this.getPath();return t.indexOf("myprofile")>=0||t.indexOf("account")>=0},routeAfterLogout:function(e){this.isIdxPage()?this.redirectAfterLogout(e):this.pageRequiresLogin()?this.redirectToAgentSigninAfterLogout(e):this.refreshAfterLogout(e)},refreshAfterLogout:function(e){window.location.reload()},redirectToAgentSigninAfterLogout:function(e){window.location.href=site_root+"agent_logout/truliapro"},redirectAfterLogout:function(e){window.location=this.site_root},isIdxPage:function(){return"undefined"!=typeof IDX_PAGE&&IDX_PAGE}});var e=Backbone.Model.extend({urlRoot:this.site_root+"_ajax/GlobalNav/AgentNav/get_agent_links/"});if(trulia.truliaAgentLinksModel=new e,$("#tpl_agent_header_nav").html()){var t=new AgentNav({el:$("#navbarAgent"),template:_.template($("#tpl_agent_header_nav").html()),model:trulia.truliaAgentLinksModel});"undefined"!=typeof agent_nav_data&&trulia.truliaAgentLinksModel.set(agent_nav_data)}else{var t=new AgentNav({el:$("#navbarAgent"),template:!1,model:trulia.truliaAgentLinksModel});t.directBind()}};$(document).ready(function(){initializeNavBarView()});